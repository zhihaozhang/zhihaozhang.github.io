<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chih-Hao&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Chih-Hao&#39;s Blog">
<meta property="og:url" content="http://zhihaozhang.github.io/index.html">
<meta property="og:site_name" content="Chih-Hao&#39;s Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chih-Hao&#39;s Blog">
  
    <link rel="alternate" href="/atom.xml" title="Chih-Hao&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chih-Hao&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">骨灰级果粉</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zhihaozhang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-invisibilitycloak" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/24/invisibilitycloak/" class="article-date">
  <time datetime="2018-08-24T09:44:50.320Z" itemprop="datePublished">2018-08-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/24/invisibilitycloak/">上架沙盒化应用,重启应用后保持文件持久访问性指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><em>Invisibility Cloak</em>上架Mac App Store了，在此过程中，遇到了一些困难，在这里记录一下又一次与苹果审核团队撕逼的过程。</p>
<p>开发这款软件的<strong>初衷</strong>是<del>将xxx.mp4/xxx.avi/xxx.mkv在白天藏起来，免得被别人发现。</del> 在Apple store上发现了一款类似的文件隐藏软件<strong>Secret Folder</strong>，售价128元，而且卖的不错。我觉得这个应用蛮有用(坏笑)，而且实现起来难度不是特别大，于是就做了一个相同功能的软件，并将它上架了。</p>
<p>功能上，我额外支持了drag&amp;drop添加文件的操作，比Secret Folder的体验更<strong>丝滑</strong>一些。定价上，仅为<strong>Secret Folder</strong>的一折，12RMB，现在特价一周，仅售6元，<em>有将某些文件在白天或演讲时藏起来的朋友们别错过。</em></p>
<p align="center"><br>  <a href="https://itunes.apple.com/cn/app/invisibility-cloak/id1426266978?mt=12" target="_blank" rel="external"><br>    <img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fukxuftu8vj309g09gt8n.jpg" width="200"><br>  <img alt="Download on the app store" src="https://user-images.githubusercontent.com/7317008/43209852-4ca39622-904b-11e8-8ce1-cdc3aee76ae9.png" width="160"><br>  </a><br></p>



<h1 id="上架过程中遇到的坑"><a href="#上架过程中遇到的坑" class="headerlink" title="上架过程中遇到的坑"></a>上架过程中遇到的坑</h1><p>不得不说，mac应用的审核比iOS应用的审核快多了，短短两天内审核了四次，这或许也从一定程度上反映了两者提交应用数量的差别。</p>
<p>第一次拒绝我的原因很<strong>奇葩</strong>，说我的名字起的不好，<strong>AVHider</strong>难道有些露骨？</p>
<p>第二次拒绝我是因为我勾选了Downloads/Picture/Music/Movie folder的读写权限，隐藏文件嘛，能Access的路径当然是越多越好了，但苹果不这么认为，他认为不该勾选的权限绝不能勾。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fugf3euvrlj313q0qggml.jpg" alt=""></p>
<blockquote>
<p>沙盒中的File Access</p>
</blockquote>
<p>第三次被拒其实有点懵，因为我在《macOS开发基础教程》这本书里看到说如果要上架，一定要勾上sandbox和printing，但苹果审核团队以printing对我没用为由，拒绝了我。或许是我理解有误，也有可能是作者的笔误。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fugfcmp305j311g0dggmq.jpg" alt=""></p>
<blockquote>
<p>《macOS开发基础教程》一书中关于上架前注意事项的描述</p>
</blockquote>
<p>第四次拒绝的原因是为了解决所有路径文件可用性时，我采取了一种粗暴的手法，直接在.entitlements文件里增加了根目录，即所有文件</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;com.apple.security.temporary-exception.files.absolute-path.read-write&lt;/key&gt;</div><div class="line">&lt;array&gt;</div><div class="line">    &lt;string&gt;/&lt;/string&gt;</div><div class="line">&lt;/array&gt;</div></pre></td></tr></table></figure>
<p>苹果让我重新找其他方法上架，于是我找到了本文需要重点介绍的:<strong>com.apple.security.files.bookmarks.app-scope</strong>.</p>
<h1 id="沙盒访问机制中的File-Access"><a href="#沙盒访问机制中的File-Access" class="headerlink" title="沙盒访问机制中的File Access"></a>沙盒访问机制中的File Access</h1><p>在iOS和macOS中，每个应用都有一个<strong>专属</strong>存储空间，它就是<strong>沙盒(sandbox)</strong>。就macOS来说，苹果规定从macOS X 10.6开始，所有发布到Mac App Store的应用都必须遵从沙盒约定，主要是考虑到第三方恶意应用对系统进行攻击，从安全性角度出发， 对应用访问的系统资源,硬件外设,文件,网络,XPC等做了严格的限制。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwly1fukwjs9uylj31iu0pq0x0.jpg" alt=""></p>
<blockquote>
<p>引入沙盒机制前后APP对系统资源、数据开放程度对比</p>
</blockquote>
<p>在没有上架之前，我没有考虑过这个问题，同样，如果你的应用不准备上架，可以不开启Sandbox，随意访问mac上的文件和数据。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwly1fukwohw5ofj30is05ujts.jpg" alt=""></p>
<blockquote>
<p>Sandbox中的File Access</p>
</blockquote>
<p>经过第二次被拒之后，我只勾上了用户选择的文件这个Type的读/写权限。但我很快就发现了问题，在应用没重启之前，一切正常运行，但是应用退出再重新打开之后，之前的文件就失去了读写的权限。</p>
<p>我们需要找到一种策略，让app<strong>记住</strong>我们曾经有过某个文件路径的读写权限，这就是app-scoped bookmark。翻译成中文是<strong>书签</strong>，也很好理解，就好像我们读一本书，某天读累了，<em>夹一张书签在上次看过的地方，下次我们再读的时候，就可以快速回到这一页，而不必从头开始一页页的翻阅了。</em></p>
<p>既然要记录下来，就涉及到持久化的问题，由于书签比较轻量级，因此我选用了相对简单的<strong>NSUserDefaults</strong>. 网上有OC版本的代码，我用Swift进行了改写，代码如下:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveBookmarks</span><span class="params">(<span class="number">_</span> filePath : String)</span></span>&#123;</div><div class="line"> </div><div class="line">       <span class="keyword">let</span> userDefault = <span class="type">UserDefaults</span>.standard</div><div class="line">       <span class="keyword">let</span> folderPath = <span class="type">NSURL</span>(fileURLWithPath: filePath)</div><div class="line">       <span class="built_in">print</span>(folderPath.absoluteString!)</div><div class="line">       <span class="keyword">do</span> &#123;</div><div class="line">           <span class="keyword">let</span> bookmark = <span class="keyword">try</span> folderPath.bookmarkData(options: .securityScopeAllowOnlyReadAccess, includingResourceValuesForKeys: <span class="literal">nil</span>, relativeTo: <span class="literal">nil</span>)</div><div class="line">           userDefault.<span class="keyword">set</span>(bookmark, forKey: folderPath.absoluteString!)</div><div class="line">       &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span> &#123;</div><div class="line">           <span class="built_in">print</span>(<span class="string">"Set Bookmark Fails: <span class="subst">\(error.description)</span>"</span>)</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">readBookmarks</span><span class="params">(<span class="number">_</span> filePath : String)</span></span>&#123;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> userDefault = <span class="type">UserDefaults</span>.standard</div><div class="line">       <span class="keyword">if</span> <span class="keyword">let</span> bookmarkData = userDefault.object(forKey: filePath) <span class="keyword">as</span>? <span class="type">NSData</span> &#123;</div><div class="line">           <span class="keyword">do</span> &#123;</div><div class="line">               <span class="keyword">let</span> url = <span class="keyword">try</span> <span class="type">NSURL</span>.<span class="keyword">init</span>(resolvingBookmarkData: bookmarkData <span class="keyword">as</span> <span class="type">Data</span>, options: .withoutUI, relativeTo: <span class="literal">nil</span>, bookmarkDataIsStale: <span class="literal">nil</span>)</div><div class="line">               url.startAccessingSecurityScopedResource()</div><div class="line">           &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span> &#123;</div><div class="line">               <span class="built_in">print</span>(<span class="string">"Bookmark Access Fails: <span class="subst">\(error.description)</span>"</span>)</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>分为<strong>保存</strong>书签和<strong>读取</strong>书签两个函数，考虑到key的唯一性，为了避免冲突我以文件路径为key存bookmark。每次应用启动之后，都根据之前的路径索取这些路径的读写权限。当然这里也是有<strong>注意点</strong>的，主要是当文件路径中包含<em>数字、字母之外</em>的字符(如中文字符、特殊字符等)时，需要注意<strong>转码</strong>。</p>
<h1 id="上架后思考"><a href="#上架后思考" class="headerlink" title="上架后思考"></a>上架后思考</h1><p>上架的第一天，在中国区付费应用总排行榜出乎我的意料的排到了第121名。这件事说明了: 1.小而美的应用是有市场的；2.用户对价格还是很敏感的；3.不少用户愿意为他们需要的应用付费。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fuger4jpwtj31kw10j46x.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/08/24/invisibilitycloak/" data-id="cjl7xi5z0001o08tdq1k7i1c8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/macOS开发/">macOS开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Match3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/02/Match3/" class="article-date">
  <time datetime="2018-08-02T07:31:04.373Z" itemprop="datePublished">2018-08-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/02/Match3/">Match for iPhone开发笔记 &lt;三&gt; 测试与上架篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>“Match问答”App今天终于通过了苹果的审核，在<em>App Store上架了，</em><a href="https://itunes.apple.com/cn/app/match问答/id1414728016?mt=8" target="_blank" rel="external">苹果商店下载地址</a>，不得不说，苹果的审核还是很严格的。因此今天想写一下从提交审核到被拒(<em>若干回合</em>)再到最终上架这段时间里的故事，其他技术方面的<strong>难点总结</strong>放到后面写。</p>
<h1 id="上架前的必经之路————测试"><a href="#上架前的必经之路————测试" class="headerlink" title="上架前的必经之路————测试"></a>上架前的必经之路————测试</h1><p>在上架之前有一个关键的步骤其实很容易被<strong>忽略</strong>，特别是<em>个人开发者</em>，没法像公司那样聘请专业的测试团队进行完备的测试。大体上讲，iOS的测试可以分为3类:</p>
<ol>
<li>单元测试、UI测试、性能测试、集成测试，通常在模拟器上进行</li>
<li>真机测试</li>
<li>Testflight内测</li>
</ol>
<h2 id="模拟器测试"><a href="#模拟器测试" class="headerlink" title="模拟器测试"></a>模拟器测试</h2><p>第一类测试通常可以发现App里所有可能的<strong>逻辑错误</strong>、<strong>排版问题</strong>和<strong>用户体验</strong>，在进行真机测试之前，一般需要保证模拟器适配各个手机尺寸，需要特别注意的是iPhone X<em>刘海的打理</em>。因为iPhone大小各异，而独立开发者通常不会有所有屏幕尺寸的机型，因此模拟器进行全面测试很有必要。</p>
<h2 id="真机测试"><a href="#真机测试" class="headerlink" title="真机测试"></a>真机测试</h2><p>第二类测试是<em>真机测试</em>，和模拟器的区别主要集中在<strong>功能</strong>和<strong>硬件</strong>两方面。功能方面，模拟器不支持信息、通话、短信、Accessibility功能(为残障人士准备);硬件方面，模拟器没有蓝牙、相机等硬件，模拟不了相关功能。如果使用了上述的功能，<strong>必须</strong>真机测试。即使没有使用，也应该安装到真机试试，<em>如果你自己都不想用这个APP，别人更不会用</em>。</p>
<h2 id="Testflight内测"><a href="#Testflight内测" class="headerlink" title="Testflight内测"></a>Testflight内测</h2><p>第三类也是需要苹果审核的，不过Testflight通常比较松，没有明显的bug、闪退一般会在24小时内批准。这一步通过之后，就可以<strong>邀请</strong>更多的亲朋好友来使用了，注意，这一步是<strong>邀请制</strong>的。需要开发者在<a href="https://appstoreconnect.apple.com/WebObjects/iTunesConnect.woa/ra/ng/app/1414728016/testflight?section=iosbuilds" target="_blank" rel="external">itunes connect</a>里手动添加相关测试人员的iCloud账号，当然也是支持<strong>CSV批量导入</strong>功能的。</p>
<p>当然Testflight测试也有限制，目前的限制提现在两方面:测试时间不超过<strong>90</strong>天、总测试人数上限是<strong>10000</strong>人，对于大部分应用来说已经很足够了。</p>
<p><img src="https://ws2.sinaimg.cn/large/0069RVTdgy1ftvhqlaq9kj31kw0yctbb.jpg" alt=""></p>
<blockquote>
<p>TestFilght页截图，可见信息有测试剩余天数、邀请数、安装数、活跃用户数、崩溃数</p>
</blockquote>
<h2 id="App崩溃的可能原因"><a href="#App崩溃的可能原因" class="headerlink" title="App崩溃的可能原因"></a>App崩溃的可能原因</h2><p>在测试过程中，App崩溃会经常发生。我遇到的比较常见的原因有:</p>
<ol>
<li>代码出错</li>
<li>OOM</li>
<li>网络状况</li>
<li>cocoapods的问题</li>
</ol>
<p>代码出错很常见，比如我经常犯的错误是ViewController的<em>强制向下转型**，明明不是某个特定VC，你强制向他转，肯定会出错；JSON编码解码也经常会出错，如果没有相应机制，就会引起闪退。</em>Objective-C*动态性能比较好，[obj method]这行代码即使obj对象没有method这个方法，在编译器也是不会报错的，但是运行时就会出错。</p>
<p>内存不够主要是应用在运行时占用了大量收集内存，使得系统强制将应用回收了。通过<strong>Instruments</strong>可以找到原因。</p>
<p><img src="https://ws4.sinaimg.cn/large/0069RVTdly1ftvo50ywacj30vk0iy3zd.jpg" alt=""></p>
<blockquote>
<p>Instruments截图</p>
</blockquote>
<p>网络状况出问题主要是网络不佳(<em>蜂窝2G/3G信号网速慢</em>)造成了相应超时;另外也有可能是后端服务器down掉了(<strong>请求太多处理不过来或受到攻击</strong>)。</p>
<p>cocoapods里的第三方库质量参差不齐，很难保证没有错误，我在开发Match初期就引了一个非常小众的库(<em>这里就不点名了</em>)，已经不work了。我没有<em>深究原因</em>，有可能是Swift版本原因或者我个人使用有误。后面换了一个star数很多的库，就解决了。总体来说，那些<strong>大名鼎鼎、维护比较勤、关注度高</strong>的库比较<strong>solid</strong>一点，也推荐大家尽量使用那样的库。</p>
<h1 id="上架"><a href="#上架" class="headerlink" title="上架"></a>上架</h1><p>上架的流程比较复杂，具体的操作步骤我在这里就不展开介绍了，有需求的读者可以参考<a href="http://www.xiaoboswift.com/course/44" target="_blank" rel="external">这个教程</a>。</p>
<p>上架过程中会遇到一些坑，我不能全方面覆盖，只能结合一些自身经历给大家一些建议。</p>
<h2 id="第一次提交审核-gt-Reject"><a href="#第一次提交审核-gt-Reject" class="headerlink" title="第一次提交审核 -&gt; Reject"></a>第一次提交审核 -&gt; Reject</h2><p>返回意见：</p>
<p><strong>Guideline 2.1 - Information Needed</strong></p>
<p>We have started the review of your app, but we were unable to successfully register for an in-app account. In order for us to review your app, please provide a demo account so that we may fully assess your app’s features.</p>
<p>第一次返回的意见是让我提供一个账户给他。Match采用的是短信动态验证，虽然我在审核信息里也说了需要审核人员填自己的手机号<em>动态获取</em>。。。但是! 谁让他的爷呢，我不得不给应用开了<strong>后门</strong>，乖乖的重新提交第二个版本。</p>
<p>第一次审核时间真是快，<strong>24小时内</strong>。</p>
<h2 id="第二次审核-gt-Reject"><a href="#第二次审核-gt-Reject" class="headerlink" title="第二次审核  -&gt; Reject"></a>第二次审核  -&gt; Reject</h2><p>返回意见：<br><strong>Guideline 2.1 - Information Needed</strong></p>
<p>This type of app has been identified as one that may violate one or more of the following App Store Review Guidelines. Specifically, these types of apps often:</p>
<p>1.1.6 - Include false information, features, or misleading metadata.</p>
<p>2.3.0 - Undergo significant concept changes after approval</p>
<p>2.3.1 - Have hidden or undocumented features, including hidden “switches” that redirect to a gambling or lottery website</p>
<p>3.1.1 - Use payment mechanisms other than in-app purchase to unlock features or functionality in the app</p>
<p>3.2.1 - Do not come from the financial institution performing the loan services</p>
<p>4.3.0 - Are a duplicate of another app or are conspicuously similar to another app</p>
<p>5.2.1 - Were not submitted by the legal entity that owns and is responsible for offering any services provided by the app</p>
<p>5.2.3 - Facilitate illegal file sharing or include the ability to save, convert, or download media from third party sources without explicit authorization from those sources</p>
<p>5.3.4 - Do not have the necessary licensing and permissions for all the locations where the app is used</p>
<p><strong>Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage</strong></p>
<p>We noticed that your app requests the user’s consent to access their camera and photos but does not clarify the use of this feature in the permission modal alert.</p>
<p>第二次审核终于进入正题了，<em>Guideline 2.1</em>给的意见比较<strong>模糊</strong>，审核人员只是将所有的条款列了出来，并没有具体说到底违反了哪条。</p>
<p><em>Guideline 5.1.1</em>是个坑，我搜了一下，很多其他开发者也都中过招。我记得之前在<strong>infoplist</strong>里是说了需要获得<em>相机/相册</em>的权限的，但是5.1.1说的是，你不仅需要申明你需要使用相机/相册，还要说<strong>为什么需要使用</strong>，编造一个原因吧。</p>
<p>针对<em>Guideline 2.1</em>，我们为了得到比较具体的回复，针对条款，<strong>逐条</strong>进行了回复，写了整整一页纸。</p>
<p>第二次审核时间：<strong>2天。</strong></p>
<h2 id="第三次审核-gt-Reject"><a href="#第三次审核-gt-Reject" class="headerlink" title="第三次审核  -&gt; Reject"></a>第三次审核  -&gt; Reject</h2><p><em>Guideline 2.1 - Information Needed</em></p>
<ul>
<li>How do users obtain 积分?</li>
</ul>
<p>终于得到了不那么应付的2.1，原来是审核人员对我们应用内的虚拟货币的获取方式产生了怀疑。这点其实挺<strong>尴尬</strong>的，因为苹果不让接入支付宝和微信购买虚拟的货品，而内购的方式苹果会抽成<strong>30</strong>%，这个比例对于我们来说太高了。因此，我们制定了一个策略，即每天登陆送1个积分；内购功能正在做(<em>其实还没有</em>)，回复了苹果提出的问题。</p>
<p><em>Guideline 2.3.10 - Performance - Accurate Metadata</em></p>
<ul>
<li>We noticed that your app or its metadata includes irrelevant third-party platform information. </li>
</ul>
<p>Specifically, a non-iOS status bar is shown in the screenshots.</p>
<p>Referencing third-party platforms in your app or its metadata is not permitted on the App Store unless there is specific interactive functionality.</p>
<p>针对<em>2.3.10</em>，这点大家也需要特别注意，苹果特别<strong>反感安卓</strong>，在任何审核人员可见的地方，尽量不要出现安卓这个词。</p>
<p>问答系统里有很多安卓用户，回答高数的形式主要有两种，一种是在纸上手写答案；第二种是在软件内写公式和推导过程，写完后，用户直接截图，就会有安卓系统的顶栏。这点也被审核人员吐槽了，没办法，只能<strong>认错</strong>，说我们会尽量要求用户去掉顶栏。</p>
<p>第三次审核时间长了起来：<strong>5天</strong>,包含了<strong>周末两天</strong>。</p>
<h2 id="第四次审核-gt-Reject"><a href="#第四次审核-gt-Reject" class="headerlink" title="第四次审核  -&gt; Reject"></a>第四次审核  -&gt; Reject</h2><p>第四次审核返回的还是2.1，关于用户获取如何积分的疑问。可能不是同一个审核人员吧，没有看我们的回复？这次我直接将首次针对这条的回复贴了进去，也是想得到一个不那么敷衍的回复罢了。</p>
<p>第四次审核时间:<strong>3天</strong>。</p>
<h2 id="第五次审核-gt-Accepted"><a href="#第五次审核-gt-Accepted" class="headerlink" title="第五次审核 -&gt; Accepted"></a>第五次审核 -&gt; Accepted</h2><p>不抱任何希望的情况下，今早收到了通知，居然被允许上架了，苹果审核真是<strong>玄学</strong>。虽然这时候已经做了最坏的打算，并开始2.0新版本的开发了，这其中就包括了<strong>内购</strong>，但1.0最终被接受也算是一件振奋人心好事儿。</p>
<blockquote>
<p>苹果审核挺蛋疼的，需要做好被拒绝几次的准备。</p>
</blockquote>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>至此，我完成了当初给<strong>XZJ同学</strong>许诺的让Match上架App Store的约定。在1个月时间内利用下班时间重拾iOS开发技巧，<strong>熬夜</strong>克服了一个又一个困难，现在回想起来还挺<strong>值得</strong>的。看到别人手机、电脑上跑着我写的应用，是我作为一个程序员最大的<strong>满足</strong>。</p>
<p>最后，打一个广告，欢迎各位同学使用Match来学高数、赚零花钱。<strong>各大应用商店有售!</strong></p>
<p align="center"><br>  <a href="https://itunes.apple.com/cn/app/match问答/id1414728016?mt=8" target="_blank" rel="external"><br>  <img alt="Download on the app store" src="https://user-images.githubusercontent.com/7317008/43209852-4ca39622-904b-11e8-8ce1-cdc3aee76ae9.png" width="160"><br>  </a><br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/08/02/Match3/" data-id="cjl7xi5y5000r08tdxsl3kc8y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-FunctionalPrograming" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/30/FunctionalPrograming/" class="article-date">
  <time datetime="2018-07-30T12:30:44.000Z" itemprop="datePublished">2018-07-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/30/FunctionalPrograming/">浅谈函数式编程 (Introducing Functional Programming)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近两周利用空余时间<strong>艰难</strong>“啃完”了objc.io出版的<a href="https://objccn.io/products/functional-swift/" target="_blank" rel="external">《函数式Swift》</a>这本书，感觉有些摸到了函数式编程的门道;在函数式编程<strong>思维</strong>的影响下，将之前的项目代码进行了改造。关于函数式编程，也算是有了一点心得，遂写成此文，虽然行文主要是以Swift为<strong>载体</strong>，但并不影响函数式思想的介绍。由于本人才疏学浅，而函数式编程本身<em>博大精深</em>，故谬误在所难免，如发现，还请指出。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fts0h9ibzrj31kw0r2ahf.jpg" alt=""></p>
<blockquote>
<p>《函数式Swift》</p>
</blockquote>
<h1 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h1><h2 id="WHAT-is-函数式编程"><a href="#WHAT-is-函数式编程" class="headerlink" title="WHAT is 函数式编程"></a>WHAT is 函数式编程</h2><p>wiki对于函数式编程的定义如下:</p>
<blockquote>
<p>In computer science, functional programming is a <strong>programming paradigm</strong>—a style of building the structure and elements of computer programs—that treats computation as the evaluation of mathematical functions and avoids changing-state and mutable data. It is a <strong>declarative</strong> programming paradigm, which means programming is done with expressions or declarations instead of statements. </p>
</blockquote>
<p>我认为最重要的两个单词是<strong>programming Paradigm</strong>和<strong>declarative</strong>，而后者又是为了描述前者准备的。什么是programming Paradigm？我在前几个月写的博客<a href="http://zhihaozhang.github.io/2018/05/20/ProtocolOP/">《面向协议编程初探》</a>中已经解释过了，中文可以翻译为<em>编程范式</em>，我理解为<strong>编程语言设计者希望编程语言的使用者在使用编程语言的时候，思考问题的方式。</strong></p>
<p>而declarative可以翻译为<em>声明式</em>的，与之相对应的是<strong>imperative</strong>(指令式的)，目前最为广泛使用的<em>面向对象编程</em>就可以划到指令式编程这一类。(declarative和imperative的区别在下文中有所提及)</p>
<h2 id="函数式编程的和面向对象编程的历史"><a href="#函数式编程的和面向对象编程的历史" class="headerlink" title="函数式编程的和面向对象编程的历史"></a>函数式编程的和面向对象编程的历史</h2><p>在函数式编程面前，面向对象编程其实是晚辈。如果以smalltalk的出现作为面向对象编程元年，那么面向对象编程的历史应该从1975年算起(数据来源<a href="https://baike.baidu.com/item/smalltalk/1379989?fr=aladdin" target="_blank" rel="external">百度百科</a>);而函数式编程的元年可以追溯到Lisp语言出现的1958年(数据来源<a href="https://baike.baidu.com/item/LISP/22083" target="_blank" rel="external">百度百科</a>)。</p>
<p>函数式编程被很多大佬美誉为<strong>the next big thing</strong>，甚至被称为<strong>最好</strong>的编程范式。让人不免疑惑，既然比面向对象编程出来的早，为什么之前没火，而现在又火了呢？</p>
<h2 id="WHY函数式编程这两年又火了"><a href="#WHY函数式编程这两年又火了" class="headerlink" title="WHY函数式编程这两年又火了"></a>WHY函数式编程这两年又火了</h2><p>带着疑问，我在搜索引擎中搜索了“函数式编程”和“火了”这两个关键词，找到了一个<a href="https://www.zhihu.com/question/30190384/answer/142902047" target="_blank" rel="external">知乎问答</a>，了解了这一段历史。</p>
<p>很赞成知乎用户<em>狗好看</em>的回答:</p>
<blockquote>
<p>根本的原因是<em>摩尔定律</em>不适用。cpu的性能提升将体现在<strong>核数</strong>增加，这样并行的程序运行速度会越来越快。并行的程序的写法就是找出不能并行的地方，其他地方都尽量并行。如果要这样写，最需要避免的事情就是赋值。函数式编程的本质就是，规避掉“赋值”。</p>
</blockquote>
<p>他的回答比较不容易懂，我来用我的理解<em>翻译翻译</em>。</p>
<blockquote>
<p>摩尔定律: 当价格不变时，集成电路上可容纳的元器件的数目，约每隔18-24个月便会增加一倍，性能也将提升一倍。</p>
</blockquote>
<p>越来越多的人知道，放在初期还是成立的摩尔定律，最近有点不适用了。这和其他很多学科一样，开始的指数级发展，很容易让人过于乐观，到了瓶颈期后，学科发展很容易停滞不前。一个最明显的例子是医学领域关于癌症的笑话，说癌症被攻克，<strong>永远还需要30年</strong>。我用的第一台电脑的CPU是<strong>奔腾4</strong>的，同期经常听到的词还有<strong>赛扬</strong>处理器，奔四有1.4GHz左右的内核时钟，到今天我用的是2016年的顶配MacBook Pro，查了一下，参数为2.7GHz(<em>约20年过去了，还不到2000年的两倍</em>)。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fts1rk3ge3j30wk0jo46i.jpg" alt=""></p>
<blockquote>
<p>2016年的顶配MacBook Pro</p>
</blockquote>
<p>Intel的工程师也尝试过将这一参数加到3GHz甚至更高，但是他们发现功耗太高、发热太快。但是每年产品线又要更新，那怎么办呢？只能是往CPU里<em>塞核心</em>来获得<strong>计算能力</strong>和<strong>吞吐量</strong>，刚刚发布的MacBook Pro 2018顶配已经用上了<strong>多达6核心的i9</strong>处理器，甚至连iPhone X都已经有了6个核心。将这些核心都利用上，可以让设备充分发挥作用，如果没有充分利用，很多核心就会在那里空转。为了充分利用多核心，在面向对象编程的世界中，经常用到的技术是<strong>同步机制和加锁</strong>，但由于函数式编程的特性，在函数式编程的世界里就不会出现这个问题，因此函数式编程又<strong>火了</strong>。</p>
<p>其实在科技界这种死灰复燃的例子还有很多，zelear的<em>王自如</em>在他的节目《科技相对论》<a href="http://www.zealer.com/post/223.html" target="_blank" rel="external">小众产品复活指南</a>里曾经介绍过几款死灰复燃产品，比如：<em>有轨电车、死飞、机械键盘、拍立得、车载广播</em>等。这些产品和函数式编程一样，都没有被<strong>替代</strong>的那么彻底，时过境迁，找到了合适的土壤，用户突然又开始想念他的某个功能，所以又活过来了。</p>
<h1 id="函数式编程的特性-HOW"><a href="#函数式编程的特性-HOW" class="headerlink" title="函数式编程的特性(HOW)"></a>函数式编程的特性(HOW)</h1><p>很遗憾，经过上一节的解释，我依然未能说清函数式编程是什么。这个问题跟面向对象等其他编程范式一样很难给出准确的定义，只能从几个比较<strong>热门</strong>的特性列举一些例子。</p>
<h2 id="一等函数"><a href="#一等函数" class="headerlink" title="一等函数"></a>一等函数</h2><p>函数的重要性在函数式编程里不言而喻，在支持函数式编程特性的语言里，函数被<strong>提到</strong>了一个非常重要的位置，他跟<em>Int、String、Bool</em>有着相同的地位。函数可以作为变量的字面量存储起来、作为函数的参数和返回值在函数之间传递。</p>
<p>函数作为变量的例子很多，只想说一句话：</p>
<blockquote>
<p>闭包是函数的<em>字面量</em>，就像1之于Int，true之于Bool。</p>
</blockquote>
<h2 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h2><p>接下来举一个函数作为返回值的例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">addFactory</span><span class="params">(value1 : Int)</span></span> -&gt; (<span class="type">Int</span> -&gt; <span class="type">Int</span>)&#123;</div><div class="line">		<span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">(value2 : Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">				<span class="keyword">return</span> value1+value2</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> adder</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> addOne = addFactory(<span class="number">1</span>)</div><div class="line">addOne(<span class="number">2</span>)  <span class="comment">// return 3</span></div><div class="line"></div><div class="line">addFactory(<span class="number">1</span>)(<span class="number">2</span>)  <span class="comment">// return 3</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(value1 : Int , value2 : Int)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> value1 + value2</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>addFactory返回的值是一个函数，其类型为(Int -&gt; Int),意思是返回值是一个接受Int并且返回Int的函数，我们可以用两种方式调用它。其中第二种addFactory(1)(2)又被称为我们习以为常的add(1,2)这种函数调用方式的<strong>Currying(柯里化)</strong>。多说一句，Currying是一个人的名字，他的全名叫<em>Haskell</em> Currying，剩下的应该不需要多解释了。</p>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>接受其它函数作为参数的函数有时被称为<strong>高阶函数</strong>。或许大多数人都使用过<em>Map/Reduce/Filter</em>，他们就是高阶函数最常见的例子。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="comment">// way 1</span></div><div class="line"><span class="keyword">let</span> strs : [<span class="type">String</span>] = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">0</span>..&lt;nums.<span class="built_in">count</span>) &#123;</div><div class="line">	strs[i] = <span class="string">"No."</span> + <span class="type">String</span>(nums[i])</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// way 2</span></div><div class="line"><span class="keyword">let</span> brr = nums.<span class="built_in">map</span> &#123;</div><div class="line">    <span class="string">"No."</span> + <span class="type">String</span>($<span class="number">0</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以Map为例，假设我们有这样一个需求，将一个整型数组，变为一个String类型的数组，并且在每个数字前加上“No.”，一个没有函数式编程思想的程序员极可能写出way1的代码，这种循环的代码几乎每个程序员都写了几千遍了，很好懂也并没有觉得有什么异常，但其实这是一种<strong>指令式</strong>的编程方式。何为指令式编程呢？就是人以机器的思维方式去思考，我们把自己当做了一台机器，比如上面way1的实现方式，就是我们将思维映射到了CPU上，强迫自己像CPU一样去思考。机器是怎么处理这个问题的呢？他首先要开辟一片内存，然后变更寄存器的值映射到变量i上，通过递增来做循环，然后创建字符串的字面量放到刚开辟出来的内存指定位置上。</p>
<p>way2使用了集合类型的高阶函数，它接收一个参数，这个参数是另一个函数(函数名不重要)，负责String的初始化的方法。当它拿到这个函数之后，自动帮我们把里面的每一个元素拿出来，传到这个String的初始化函数里面去，就生成了最终的数组。这就是<strong>声明式编程</strong>，好处很明显，代码比以前短了很多，思维方式变得更像人思考的方式了。</p>
<p>有了高阶函数，函数可以自由<strong>装配</strong>，由一些简单的函数<strong>装配</strong>出一些高级的函数。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fts5pfl6e9j30fz089jrz.jpg" alt=""></p>
<blockquote>
<p>装配过程的可视化</p>
</blockquote>
<p>关于函数组合的例子，《函数式Swift》给出的实例是对CoreImage库的使用，对一幅图像进行<strong>模糊、加滤镜、切圆角</strong>等操作。一些网红照片的出炉，通常也是由这些看似最简单的操作组合起来的。</p>
<h2 id="纯函数-pure-function"><a href="#纯函数-pure-function" class="headerlink" title="纯函数(pure function)"></a>纯函数(pure function)</h2><p>在函数式编程中，对于函数还有两点特殊的要求。</p>
<ol>
<li>不依赖外部</li>
<li>不改变外部<br>满足上面两点要求的函数被称为<em>纯函数(pure function)</em>。这两点保证了无论在什么时候调用函数，对于相同的输入，总会得到相同的输出。这至少带来了两点好处：</li>
</ol>
<p>1.函数的可测试性</p>
<p>2.上文提到的函数式编程没有的<em>同步与加锁</em>问题</p>
<p>至此也可以引出函数式编程的<strong>思想</strong>了:</p>
<blockquote>
<p>避免使用程序状态和可变对象，是降低程序复杂度的有效方式之一，而这也正是函数式编程的精髓。函数式编程强调执行的结果，而非执行的过程。我们先构建一系列简单却具有一定功能的小函数，然后再将这些函数进行组装以实现完整的逻辑和复杂的运算，这是函数式编程的基本思想。</p>
</blockquote>
<h2 id="函子、适用函子、单子-Functor-Applicative-Monad"><a href="#函子、适用函子、单子-Functor-Applicative-Monad" class="headerlink" title="函子、适用函子、单子(Functor, Applicative, Monad)"></a>函子、适用函子、单子(Functor, Applicative, Monad)</h2><p>这个部分需要单独写一篇文章介绍，我在理解过程中发现了一个很好的<a href="http://jiyinyiyong.github.io/monads-in-pictures/" target="_blank" rel="external">图解blog</a>.</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fts5vo3dsoj30og07gmy7.jpg" alt=""></p>
<p>这里先给出结论：<br>functor: 通过 fmap 或者 &lt;$&gt; 应用是函数到封装过的值<br>applicative: 通过 &lt;*&gt; 或者 liftA 应用封装过的函数到封装过的值<br>monads: 通过 &gt;&gt;= 或者 liftM 应用会返回封装过的值的函数到封装过的值</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>《函数式Swift》(<a href="https://objccn.io/products/functional-swift/" target="_blank" rel="external">https://objccn.io/products/functional-swift/</a>)</li>
<li>smallTalk 百度百科 (<a href="https://baike.baidu.com/item/smalltalk/1379989?fr=aladdin" target="_blank" rel="external">https://baike.baidu.com/item/smalltalk/1379989?fr=aladdin</a>)</li>
<li>Lisp 百度百科(<a href="https://baike.baidu.com/item/LISP/22083" target="_blank" rel="external">https://baike.baidu.com/item/LISP/22083</a>)</li>
<li>知乎:为什么函数式编程这两年又火了(<a href="https://www.zhihu.com/question/30190384/answer/142902047" target="_blank" rel="external">https://www.zhihu.com/question/30190384/answer/142902047</a>)</li>
<li>《科技相对论》小众产品复活指南(<a href="http://www.zealer.com/post/223.html" target="_blank" rel="external">http://www.zealer.com/post/223.html</a>)</li>
<li>Functor, Applicative, 以及 Monad 的图片阐释 (<a href="http://jiyinyiyong.github.io/monads-in-pictures/" target="_blank" rel="external">http://jiyinyiyong.github.io/monads-in-pictures/</a>)</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/07/30/FunctionalPrograming/" data-id="cjl7xi5xp000b08td4eowc6ah" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/">swift</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Match2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/23/Match2/" class="article-date">
  <time datetime="2018-07-23T09:43:02.370Z" itemprop="datePublished">2018-07-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/23/Match2/">Match for iPhone开发笔记 &lt;二&gt; 网络请求和数据流篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>书接<a href="http://zhihaozhang.github.io/2018/07/11/Match/">上文</a>,作为一个<strong>数据驱动</strong>(<em>Data driven</em>)类的APP,如何从服务器端<em>获取到数据</em>并发送<strong>尽量少</strong>的请求次数是一个非常重要的点，甚至被定为<strong>最重要</strong>的点也不为过。这篇博客将介绍我在做Match这个应用过程中使用到的技术以及优化的方法。</p>
<h1 id="网络请求库"><a href="#网络请求库" class="headerlink" title="网络请求库"></a>网络请求库</h1><h2 id="Alamofire、Moya和Just"><a href="#Alamofire、Moya和Just" class="headerlink" title="Alamofire、Moya和Just"></a>Alamofire、Moya和Just</h2><p>现有的网络请求库非常多，从OC时代<em>大名鼎鼎</em>的<strong><a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="external">AFNetworking</a></strong>到Swift时代的<strong><a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="external">Alamofire</a></strong>及它的进一步封装<em><a href="https://github.com/Moya/Moya" target="_blank" rel="external">Moya</a></em>,都是对苹果网络层URLSession的封装，且有着相似的目的<strong>：将网络请求从ViewController中解耦出去。</strong>ViewController中如果混杂了太多的网络请求的<strong>构建</strong>、<strong>发送</strong>、<strong>响应接收</strong>、<strong>响应请求的处理</strong>，会使得ViewController非常<strong>臃肿</strong>，不利于代码维护。</p>
<p><img src="https://moya.github.io/web/diagram.png" alt=""></p>
<blockquote>
<p>Moya在Alamofire的基础上进一步对网络请求进行了封装，使网络请求更容易</p>
</blockquote>
<p>考虑到Alamofire和Moya引入的成本较高，我发现了另一个更容易上手的库，名字也很酷，叫<a href="https://github.com/JustHTTP/Just" target="_blank" rel="external">Just</a>,名字就感觉<strong>屌屌</strong>的，用起来也是出奇的好用，调用<em>GET/POST</em>请求<strong>Just</strong>需要一行代码，</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  get request</span></div><div class="line"><span class="type">Just</span>.<span class="keyword">get</span>(<span class="string">"http://httpbin.org/get"</span>)</div><div class="line"></div><div class="line"><span class="comment">//  post request</span></div><div class="line"><span class="type">Just</span>.post(</div><div class="line">    <span class="string">"http://justiceleauge.org/member/register"</span>,</div><div class="line">    data: [<span class="string">"username"</span>: <span class="string">"barryallen"</span>, <span class="string">"password"</span>:<span class="string">"ReverseF1ashSucks"</span>],</div><div class="line">    files: [<span class="string">"profile_photo"</span>: .<span class="type">URL</span>(fileURLWithPath:<span class="string">"flash.jpeg"</span>, <span class="literal">nil</span>)]</div><div class="line">) &#123; r <span class="keyword">in</span></div><div class="line">    <span class="keyword">if</span> r.ok &#123; <span class="comment">/* success! */</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但由于这个项目已经1年多没人维护了，只支持到了Swift 3，在github上发现一堆Swift 4的issue list，因此不得不再寻找其他网络请求库。这时候，<a href="https://github.com/daltoniam/SwiftHTTP" target="_blank" rel="external">SwiftHTTP</a>出现在我视野中，并成了我最终的选择。</p>
<h2 id="SwiftHTTP成了最终的选择"><a href="#SwiftHTTP成了最终的选择" class="headerlink" title="SwiftHTTP成了最终的选择"></a>SwiftHTTP成了最终的选择</h2><p>SiwftHTTP有着和Just类似的简洁语法，能做到一行代码解决HTTP请求。对需要快速完成整个APP开发的我来说，它能够<em>构建请求并发送</em>、<em>接收响应并处理</em>，加上它的体积小、用法简单等优点，简直就是<strong>简单、可依赖</strong>最好的诠释。当然，Alamofire和Moya存在的价值是不可否定的。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/4/3/16288fa6039c2696?imageView2/0/w/1280/h/960/ignore-error/1" alt=""></p>
<blockquote>
<p>网络请求库的简单流程</p>
</blockquote>
<h2 id="SwiftHTTP响应的处理"><a href="#SwiftHTTP响应的处理" class="headerlink" title="SwiftHTTP响应的处理"></a>SwiftHTTP响应的处理</h2><p>网络请求的响应都是二进制数据，具体到iOS，是NSData类型的数据，因此需要将响应结果进行<strong>编码</strong>。比如拿到的结果是一张图片，在你用<strong>UIImage</strong>对其<em>编码(decode)</em>之前，在计算机看来，它跟其他音频、视频甚至字符串没有什么俩样，都是一串<em>二进制码</em>。</p>
<p>有过网络方面开发经验的朋友都知道，无论是响应还是请求，除了我们最想要数据部分(<em>请求体</em>)，还有额外的<strong>开销(头部)</strong>，他们告诉你这段请求成功了没有、什么原因没有成功、请求从哪里来、到哪里去等信息，真正有用的部分其实只占了一部分。这也是为什么需要尽量减少网络请求次数的原因，因为这些<strong>额外</strong>的部分，也是会带来<strong>开销</strong>的。网络请求次数太多难免造成应用卡顿，使得用户体验较差。</p>
<p>具体到SwiftHTTP，我获取到的响应体可能是一个<strong>String</strong>、一个<strong>Int</strong>值、一个<strong>Double</strong>值，更多的时候，是一个<em>对象(Object)</em>，我们需要根据和后端开发者的约定，将其进行正确编码。对Object的编码是较为复杂的,示例如下:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> <span class="type">HTTP</span>.<span class="type">POST</span>(servlet_path!)&#123; response <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> error = response.error&#123;</div><div class="line">                <span class="built_in">print</span>(error)</div><div class="line">                <span class="keyword">return</span></div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">do</span> &#123;</div><div class="line">                <span class="keyword">let</span> decoder = <span class="type">JSONDecoder</span>()</div><div class="line">                <span class="keyword">self</span>.user_history = <span class="keyword">try</span> decoder.decode(history.<span class="keyword">self</span>, from: r.data)</div><div class="line">            &#125;<span class="keyword">catch</span>&#123;</div><div class="line">                <span class="keyword">return</span></div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line"></div><div class="line"><span class="comment">// history 遵从**Codable**</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">history</span> : **<span class="title">Codable</span>**</span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> asked : [<span class="type">Int</span>]!</div><div class="line">    <span class="keyword">var</span> campaigning : [<span class="type">Int</span>]!</div><div class="line">    <span class="keyword">var</span> favourite : [<span class="type">Int</span>]!</div><div class="line">    <span class="keyword">var</span> phoneNumber : <span class="type">Int</span>!</div><div class="line">    <span class="keyword">var</span> replied : [<span class="type">Int</span>]!</div><div class="line">    <span class="keyword">var</span> tableIndex : <span class="type">Int</span>!</div><div class="line">    <span class="keyword">var</span> voting : [<span class="type">Int</span>]!</div><div class="line">    <span class="keyword">var</span> won : [<span class="type">Int</span>]!</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>相应的处理流程是先判断有没有错误，如果有错，直接返回；没有错误的前提下，使用SwiftyJSON中的JSONDecoder对Object进行编码，需要用do和catch<strong>包围</strong>，因为这一过程不保证一定能成功。</p>
<blockquote>
<p>如果结果是数组，将<strong>history.self</strong>改为<strong>[history].self</strong>即可。</p>
</blockquote>
<p>需要提前申明Object的类型，且服从<strong>Codable</strong>协议。这里我选用了<strong>Strcut</strong>而不是<strong>Class</strong>，两者的具体区别感兴趣的可以自行去搜索，主要区别是Struct是<strong>值类型</strong>，Class是<strong>引用类型</strong>的。</p>
<p>当然，String和Int等其他基本类型也有自己的编码方法。比如String的编码方法为:String(data: r.data, encoding: String.Encoding.utf8)。</p>
<h2 id="Object-Model文件的生成和注意事项"><a href="#Object-Model文件的生成和注意事项" class="headerlink" title="Object Model文件的生成和注意事项"></a>Object Model文件的生成和注意事项</h2><p>Struct和Class的生成可以借助第三方工具<strong><a href="https://github.com/Ahmed-Ali/JSONExport" target="_blank" rel="external">JSONExport</a></strong>完成，国内有人将其进行了<a href="https://github.com/yagamis/JSONExport" target="_blank" rel="external">汉化</a>,可以很方便的导出我们所需要的Swift model文件。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftjy4408vwj31ju1440xs.jpg" alt=""></p>
<blockquote>
<p>JSONExport汉化版界面</p>
</blockquote>
<p>在使用JSONExport之前，网络请求的结果一般是通过PostMan获取的，有些字段的结果可能是<strong>nil</strong>,直接复制进去JSONExport就会将该字段申明为<strong>Any</strong>，但是这就让编译器为难了，因为他并不知道需要为这个字段开多大的空间。因此当你尝试让该Struct服从<strong>Codable</strong>协议时，<strong>会报错</strong>，这时就需要与后端开发人员沟通，<em>将Any改为正确的特定类型。</em></p>
<h1 id="从数据流角度减少网络请求数"><a href="#从数据流角度减少网络请求数" class="headerlink" title="从数据流角度减少网络请求数"></a>从数据流角度减少网络请求数</h1><p>上文已经提到了，网络请求会给系统带来很大的一笔开销，减少网络请求数是开发者在开发应用过程中优化应用的一个<strong>重要方面</strong>。这里，我给出在做Match过程中减少网络请求数比较<em>Hack</em>的一个小技巧，也不知道对不对，总之是有效的减少了网络请求数。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftjx2jktw7j31j417yadt.jpg" alt=""></p>
<blockquote>
<p>从<em>数据流(data-flow)</em>角度看应用</p>
</blockquote>
<p>鉴于在应用开发过程中反复了这种模式，这里只需举一个业务场景来说明即可。上图中涉及了三个场景，第一个场景是问题列表页，是一个TableView，数据是从服务器端获取的(默认20个)。当用户点击TableView的某个Cell，会跳转到问题详情页，包含了该问题的题干和回复部分，这部分数据是由第一个场景传过来的，至此没有<strong>再次</strong>发送获取信息的网络请求。</p>
<p>第三个场景是用户尝试回答这道题目，点击发送之后，回到第二个场景，这时候如果不做任何动作，用户是看不到自己刚刚的回复内容的，这很容易让用户<strong>造成困惑。</strong>但是我又不想再次发送网络请求来更新数据，于是我借助了<strong>App Delegate</strong>这个<em>中转站</em>，将刚刚用户回复的相关信息进行了保存，并<em>人为的</em>添加到了TableView的数据中。这样，在没有发送任何数据请求的前提下，做到了视图已经更新的<strong>假象</strong>。</p>
<h1 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h1><p>早在写上一篇开发笔记的时候，就有读者问能否像之前的应用一样将Match<strong>开源</strong>。诚然，作为一个完整的应用，有着较大的借鉴意义，但是考虑到朋友为这个应用的开发向我支付了不菲的费用，这个应用最终版权应属于他，所以考虑再三，决定<strong>不开源</strong>，还望大家理解。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/07/23/Match2/" data-id="cjl7xi5y1000n08td429z1670" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-buy-houseII" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/18/buy-houseII/" class="article-date">
  <time datetime="2018-07-18T08:56:29.813Z" itemprop="datePublished">2018-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/购房/">购房</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/18/buy-houseII/">魔都买房杂记(下)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>上一篇博客<a href="http://zhihaozhang.github.io/2018/07/16/buy-house/">魔都买房杂记(上)</a>写完分享以来，我只在朋友圈进行了分享，便得到了近300次的阅读，我微信好友一共才<em>400</em>人。虽然可能存在某些好友多次阅读了这个文章的现象，但还是不难看出<strong>楼市</strong>的受关注度，毕竟它挑动着每一个人的<strong>神经</strong>，每个人都迟早是有一块地方要安定下来的。</p>
<p>在写这篇博客的时候，我已经走完了剩下的几乎所有流程，完成了<strong>草签</strong>(合同与正式网签一样)，只剩下网签这最后一步了。这篇博客，我准备书接上文，将后续的流程写出来，方便读者就看到完整的新房购买过程;同时，将重点放在二手房的<strong>看房、选购</strong>和<strong>谈价</strong>技巧，和上文一样，由于我的<em>不专业性</em>，所提意见有强烈的<em>个人主观色彩</em>，也不接受任何质疑和撕逼，仅供大家参考。</p>
<h1 id="选房后的签约"><a href="#选房后的签约" class="headerlink" title="选房后的签约"></a>选房后的签约</h1><p>签约有很多流程，由于我认购楼盘的房源比较多，需要打印的东西太多，即使10台打印机同时出动依然来不及。并且网签需要时间，而zf网签系统只在指定的时间段内开放，所以昨晚我经历的只能算是<strong>草签</strong>。</p>
<p>草签和正式签差别并不大，所有合同都是一样的，只是为了<em>减少正式网签</em>的确认时间，过程还是需要<strong>仔细核对</strong>的，我在核对过程中就发现草签合同里把我购买的房屋售价<strong>写错</strong>了。</p>
<p>需要签的合同非常多，而且通常至少是一式两份，如果嫌写名字太麻烦，也可以带<strong>个人印章</strong>。合同的细节非常多，这时候我不知道除了接受，还有没有argue的余地了。反正我是无脑的签完了，整个流程需要<strong>两个小时</strong>。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fte9lrckdnj30r80qadh3.jpg" alt=""></p>
<blockquote>
<p>众多合同之一，其他涉及敏感信息的合同不宜展示</p>
</blockquote>
<p>草签最终合同之前，是需要付清<strong>除了贷款部分所有钱的</strong>。注意，只能刷个人名下的银行卡(最多两张)。由于金额太大，刷卡前最好跟银行客服确认好刷卡额度，现场排队的时候你再去跟人确认申请调整就太浪费时间了。付完钱后，注意<strong>一定</strong>要保留好pos机的票和<strong>收据</strong>。</p>
<p>接下来就是等正式的网签通知啦~</p>
<h1 id="二手房看房、选购、谈价"><a href="#二手房看房、选购、谈价" class="headerlink" title="二手房看房、选购、谈价"></a>二手房看房、选购、谈价</h1><p>坦率的讲，这批16年被捂的新盘开完后，上海未来三年内新房将会<strong>极少</strong>。这并非我信口开河，而是由土拍市场决定的，且后面zf想租售并举，所以短期内买新房的机会真的<strong>不多</strong>了，有<strong>房票</strong>和<strong>火力</strong>的抓紧了。<br><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fte9rsnspej30u60omgn3.jpg" alt=""></p>
<p>我看的二手房也不少，也经历过几次与房东谈价格(包括面对面和电话谈价)，也小小的总结了一点点经验和教训，提供给有购买二手房打算的朋友做个参考。</p>
<h2 id="二手房看房"><a href="#二手房看房" class="headerlink" title="二手房看房"></a>二手房看房</h2><p>二手房看房一般是需要提前预约的，守时很重要，因为对方交易也想找个靠谱、讲信用的人，而守时都不能做到，会大大减分。</p>
<p>除此之外，我觉得二手房看房最需要注意是<strong>不卑不亢</strong>，在房东(包括中介)面前不要<strong>暴露</strong>出你的真实想法。在房东面前，<strong>尽量找他房子的一些缺点</strong>，比如<em>楼层不好、朝向不好、装修</em>不好等，<strong>暗示他你的房子并没有你想象的那么好</strong>，给后面的谈价<strong>留出足够的余地</strong>。之前就是有次在某个房东面前表现的太喜欢他房子了，被他吃定了的感觉。最后跟他谈价没有成功，后面他居然以低于我报价10万的价格将房子售出了。</p>
<p>如果真的是很喜欢，<strong>暗自窃喜</strong>就行，不要表现出来，最多就说还行吧。如果真的不喜欢，那也好办，当房东面多说一些他的优点，出门后再也不联系就行。</p>
<p>我发现我最开始看房最大的一个错误就是主要<strong>看装修了</strong>，其实装修好这事也不全是好处。房东会在总价里体现出来，而房屋的装修用料什么的需要时间来<em>检验</em>。其实看二手房，最主要看的是<strong>户型</strong>，户型好很重要，相比于高昂的房价，<em>装修其实没那么值钱</em>。有些装修一般的房子，售价要比<strong>号称“精装”</strong>的房子便宜非常多，那他的房子就显得性价比非常高了。</p>
<p>之前有人说毛坯房最好，自己拿来想怎么装修就怎么装修。这点我非常认同，因为那种<strong>半吊子</strong>房屋你如果想重新装修，不得不先把之前装修处理掉，然后再进行重新装修，这个过程显然是比毛坯直接装修要<strong>麻烦</strong>的，当然装修过程中是需要费一些<strong>精力</strong>和<strong>时间</strong>的。</p>
<p>觉得满意的房子，在正式进入谈价之前，需要<strong>委托中介做产调、确认房子无抵押、向小区里的人打听房子里面没有出过事(成交后因为凶宅闹上法庭的案例不少)。</strong></p>
<p>总结：</p>
<blockquote>
<p>二手房<strong>看户型不看装修</strong>，通常 毛坯房 &gt; 简装房，<strong>真</strong>精装房根据与毛坯的溢价定，谈价前请中介做产调。</p>
</blockquote>
<h2 id="二手房谈价"><a href="#二手房谈价" class="headerlink" title="二手房谈价"></a>二手房谈价</h2><p>二手房谈价是个技术活，一般是由中介进行<strong>初步沟通</strong>的。比如这个房子你想以<strong>500</strong>万买到，你就应该告诉中介，我最多出<strong>480</strong>万，让他去跟房东进行沟通。房东一般是不同意的，会抛出一个价格，如果不高于<strong>520</strong>，那你们就可以坐下来面对面谈了，因为房东对中介也不会说出心里的底价，最终价格都是需要和真实客户面对面商量的。</p>
<p>有了上一步的铺垫，你抓住他房子的缺点，告诉他你出价的理由(<em>列缺点</em>)，如果对方态度友好，最后适当降价达到了你心理预期价格，你就装作免为其难的<strong>接受</strong>吧，毕竟人都有贪小便宜的缺点，愉快的成交就行。如果实在不行，而且你又很想得到这个房子，那就看加价的幅度能不能承受，遇到真正喜欢的就下手吧，多几万<strong>放在30年来看</strong>也不是多大的问题。</p>
<p>谈价分为税费各付价和买房付价，其实差别也不大，羊毛还是出在羊身上。还是那句话，这种重要的事情最好是能够当面坐下来谈，如果谈到价格低于你的心理预期了，可以付个十万二十万定金，防止房东<strong>反悔</strong>，因为你看中的房子，其他人很可能因为喜欢这套房子，愿意比你多出几万。</p>
<h2 id="对中介的态度"><a href="#对中介的态度" class="headerlink" title="对中介的态度"></a>对中介的态度</h2><p>买二手房，选中介真的很重要，好的中介推荐的房子靠谱，而且砍价多，做事稳妥。站在中介的立场上考虑，他最希望的就是卖家和买家尽快成交，他好去搞定新的客户，最怕把战线拖的太长了。</p>
<p>一般中介不会特别<strong><em>偏袒</em></strong>买家或者卖家，他能迅速找到一个价格，让买卖双方都能接受，拿到中介费，对他来说是最重要的。在中介面前也需要有所保留，不能把你心里的真实想法和价格告诉他。极端情况下，你甚至可以给中介<strong>悬赏</strong>，比如上面的例子，你告诉他如果他能把价格搞到480万，你另给<strong>5</strong>万他作为奖励，这样他就会<strong>有动力</strong>去跟房东砍价，中介的口才一般是比你好的多的。如果最终他做到了，你也以<strong>485</strong>万(低于心理预期的<strong>500万</strong>)成交了；如果他没有做到，有了上面中介与房东的砍价过程，房东的<em>心理预期价格</em>通常会有所<strong>松动</strong>，你后面再谈价会<strong>顺利</strong>一些。</p>
<p>如果价格合适，双方都能接受，下面就是谈中介费了。很遗憾，我没能走到这一步，因此不能给出太多有效建议，但是上海的中介一般会要求你给房屋售价的<strong>2%</strong>，从我身边朋友了解到的情况来看，通常最终都在<strong>1.4%-1.6%</strong>之间，这里推荐<strong>正规的大中介(如链家)</strong>。某些中介上来就说他们只收<strong>1%</strong>的费用，这种尤其需要<strong>警惕</strong>。</p>
<h1 id="市区二手小房子和郊区大房子怎么选"><a href="#市区二手小房子和郊区大房子怎么选" class="headerlink" title="市区二手小房子和郊区大房子怎么选"></a>市区二手小房子和郊区大房子怎么选</h1><p><strong>写在前面:</strong>如果你资金足够，市区成熟的<em>学区、医院和商圈</em>还是会给你的生活带来很多便利。这个章节主要是给预算<strong>不那么足</strong>的人看的。</p>
<p>选购市区二手房的主要原因可能还是由于它的<em>地段好，周边配套比较齐全</em>。相比于郊区的房子，市区的二手房更为<strong>保值</strong>，这点是毋庸置疑的。保值是指大环境不好，万一房价下跌时候，市区价格表现更为坚挺;但是对于房价上涨，升值空间就不好说了，由于市区配套已经很齐全了，周边配套暂时不全的郊区完善后带来的利好，市区是享受不到的。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fte4z3bv7pj308c0ckglz.jpg" alt=""></p>
<blockquote>
<p>1997年从东方明珠上俯瞰陆家嘴</p>
</blockquote>
<p>20年前从东方明珠上俯瞰陆家嘴，是上图的场景，从图片中看，荒凉到还不如现在的郊区。放到当时，你会投资吗？房子买的是未来，买配套成熟的不叫<strong>投资</strong>，只能叫<strong>储蓄</strong>。</p>
<p>郊区空气好，环境好，也相对比较安静。但郊区也可能会有<strong>飞机</strong>经过、<strong>高铁</strong>经过，距离<em>垃圾焚烧厂、变电站</em>等对人体不利的功能场所比较近等缺点。这些都是需要<strong>综合考虑</strong>的。</p>
<h1 id="最后的感悟"><a href="#最后的感悟" class="headerlink" title="最后的感悟"></a>最后的感悟</h1><p>其实在大城市买房，是需要<em>两代</em>(<em>甚至三代人</em>)的努力的，知乎上经常有问题问该不该掏空6个钱包来买房这种问题。大部分的回答是趋同的，即<em>应该掏空买</em>。因为这样能让父辈和祖辈的资产更保值甚至升值，因为把钱投入到楼市，比起存到银行或者放到最近经常炸雷的<strong>P2P</strong>，已经是<strong>对抗通货膨胀</strong>很优秀、<em>很无脑</em>的方法了。房贷也是这样，<strong>4.9%</strong>的基础利率，比起每年通货膨胀率的7%-9%来说，<strong>狠赚</strong>，因此能多贷尽量多贷。毕竟国家肯一次性借给你这么多钱的机会，通常也就买房这一次了。</p>
<p>工薪阶层如果完全白手起家，是很难凑够首付的，正如上篇博客结尾梁老师微博说的那样，郊区买不了也别拧巴，东南沿海城市了解一下，实在不行就回家找个能发挥先进经验的行业，<strong>给孩子铺个路。</strong></p>
<h2 id="三代人的“美国梦”"><a href="#三代人的“美国梦”" class="headerlink" title="三代人的“美国梦”"></a>三代人的“美国梦”</h2><p>文末，我引两个故事。第一个是美国<strong>华裔</strong>前商务部部长骆家辉的故事。骆家辉先生的祖父<strong>1880</strong>年去到美国，从一名仆人做起，学习语言同时挣钱，而后回到中国组建家庭。在骆家辉的父亲12岁时，祖父又把一家人带回了美国。骆家辉父亲像半个ABC一样，在美国度过了青少年时光，成年后参军并参加了第二次世界大战，还参与了诺曼底登陆。随后，他的父亲也像祖父一样，回到香港组建了家庭，最后再次举家回到美国，定居西雅图。</p>
<p>骆家辉记得，在自己幼儿园时期，母亲也在为了成为美国公民学习英语。除了学习语言，父母还做了一些小生意维持生计。不管做什么，他很清楚的认识到，家庭的重心，父母的重心，都放在三件事情上：<strong>第一，获得优良的教育；第二，努力奋斗；第三相互扶持。</strong></p>
<p>他的父母和中国大多数父母一样，节俭的生活，即使再穷也没有穷子女的教育，为的就是让他们能够过上更好的生活，抓住更多的机遇。正是因为如此，骆家辉先生成为了美国历史上第一位美国本土的亚裔州长和第一位华裔州长。</p>
<p><img src="https://gss0.bdstatic.com/94o3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=920aeb7fbe096b63951456026d5aec21/b03533fa828ba61e309fe47f4134970a304e5968.jpg" alt=""></p>
<blockquote>
<p>在就职典礼上，他开玩笑说，州长宅邸距离自己祖父曾经帮佣的那间房子只有<em>一英里的距离</em>，但是他们家族花了<strong>整整100年时间</strong>才<em>走完这段路</em>。</p>
</blockquote>
<h2 id="《神秘的西夏》"><a href="#《神秘的西夏》" class="headerlink" title="《神秘的西夏》"></a>《神秘的西夏》</h2><p>我最近一直在看一部央视纪录片《神秘的西夏》，讲的是西夏的开国皇帝<strong>李元昊</strong>在祖父李继迁和父亲<strong>李德明</strong>长达数十年积攒实力后，<strong>称帝</strong>并和建立了与宋、辽三分天下的百年基业。</p>
<p><img src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=4720b4d9b6b7d0a26fc40ccfaa861d6c/50da81cb39dbb6fdb8723d4d0d24ab18972b37b4.jpg" alt=""></p>
<p>神秘的西夏这部<strong>充满诚意</strong>的纪录片，涉及了西夏<em>文化、经济、政治、军事</em>等诸多方面，看完这部纪录片我懂了很多，<em>历史</em>就是不断重复的<strong>人性</strong>，很多道理和规律放到今天还是这样，<strong>强烈</strong>建议感兴趣的朋友可以去看看。</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>买房这段时间我一直在想，我的<strong>成长过程</strong>和我的孩子将来会怎么样。</p>
<p>我出生于江苏<strong>四线</strong>城市(的镇子上)，从小少有人管，属于完全的<strong>放养</strong>状态。由于父母比较忙，我经常是只能放了学玩到天黑，饿到不行才到隔壁老爷爷家吃口饭。虽然贪玩，但我还算自觉，基本能坚持做到先做完作业再玩。初到大学，我发现周围的同学都有很多才艺，而我却没有什么拿得出手的才艺。但我从未抱怨过，我觉得农民身上的<strong>纯朴</strong>是千金难换的。我预感到我孩子将来的成长环境<strong>同比</strong>会比我好一些，可能也会像很多城里孩子那样接受很多种类的学前班、兴趣班。另外，优秀小学也是个资源，这就是<strong>学区房</strong>售价高的主要原因，但是由于预算不够，暂时不能给他提供好的学区。</p>
<p>上一辈总是希望下一辈能够过的比自己好，因为下一辈总是站在上一辈的肩膀上。和平年代，那种<strong>朝为田舍郎，暮登天子堂</strong>的情况已然不可能发生，某一代人突然成为行业的领袖、一飞冲天，概率也并不是很大。</p>
<p>吴军老师曾在《<strong>硅谷来信</strong>》中提到过这个现象，他把社会阶级进行了分层(比如<strong>100</strong>层)，这100层大致是类似于金字塔那样的结构，越往上走，人数会越少。有些人命好，出生在第10层的家庭，那他10%的努力可能都比第90层的人100%的努力有效。这不能说是不公平，是由他父辈甚至祖辈的努力带来的。对第90层的人来说，让在他这一辈就冲到第10层的难度非常大，他能通过自己的努力，尽可能多<strong>往上*</strong>拱几层<em>，为他的孩子铺个路已经很好了。同样，对于第10层的人来说，如果他不够努力，在他这一代人掉到二三十层也是有可能的，但他通常活的比开始第90层要好很多。</em>懂了这个道理，看很多东西也就看开了。*</p>
<p>大部分家庭是需要一代人接着上一代人进行<strong>扎实努力</strong>，<em>扶摇曲折向上</em>的。最后希望大家日子都能越过越<strong>红火</strong>，家族越来越<strong>兴旺</strong>，一代更比一代强!</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fte9nruvz2j30u01sz78m.jpg" alt=""></p>
<blockquote>
<p>我未来的家(总高18楼的12楼)</p>
</blockquote>
<p>———<strong>谨以此文献给帮助过我的亲人们</strong>———</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/07/18/buy-houseII/" data-id="cjl7xi5yn001508tddekyvgg7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随感/">随感</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-buy-house" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/16/buy-house/" class="article-date">
  <time datetime="2018-07-16T11:14:16.002Z" itemprop="datePublished">2018-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/购房/">购房</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/16/buy-house/">魔都买房杂记(上)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="为什么要写这篇博客"><a href="#为什么要写这篇博客" class="headerlink" title="为什么要写这篇博客"></a>为什么要写这篇博客</h1><p>近期终于在魔都<strong>上海</strong>买到了一个属于自己的三房，在一线城市有了一个稳定的<em>安身立命</em>场所。经历了大半年的看二手房、和房东谈价格，到最终选择新房、认筹、摇号、选房。一来记录一下这段经历，二来也为想买房的人提供一些<strong>参考</strong>吧，也仅仅是参考了，毕竟我不是<strong>专业</strong>的。</p>
<h1 id="购买新房"><a href="#购买新房" class="headerlink" title="购买新房"></a>购买新房</h1><p>决定购买新房是在一次和二手房房东谈价谈崩之后，加上刚刚过去，印象比较深刻，有必要先行记录一下。</p>
<h2 id="购买新房的好处"><a href="#购买新房的好处" class="headerlink" title="购买新房的好处"></a>购买新房的好处</h2><p>众所周知，由于zf限价，新楼盘一般售价是低于周边二手房的，因为二手房需要支付约2%的中介费、个税(与是否满五唯一相关)、增值税(<strong>5.37%</strong>)和契税(新房也需要)，大部分的房子加起来也要9%，即使是满五唯一的房子，也会被卖家作为一个卖点体现在了售价之中，<strong>毕竟羊毛出在羊身上</strong>。</p>
<p>而新房就没这么多杂七杂八的费用，现在由于限价，售价比起周边二手，有不小的优势。因为zf可以限制开发商定价，不让他们拿预售证，但是无法跟老百姓们说，你们卖贵了，降价吧。</p>
<p>除了这些费用，新房最大的好处是房子是全新的，没有他人使用过，也不用担心之前里面出过什么事情，一般买二手房都需要去小区里打听打听需要购买的房子里面出了什么事情没有、咨询房东的出售房子的动机(回答不一定真实)。</p>
<p>这一批开盘的房子，很多都是被捂盘了两年的，如果是精装交付的房子，装修一般是已经装修好了，没法降低装修标准，在zf限价的大环境下显得尤为值当。无法保证，后面如果继续限价，开发商在装修时候不降准，达到一期同样的水准。</p>
<p>新房由开发商统一定价，都有一房一价表，不需要(也不可能)遇到二手房时和房东谈价的过程，这个过程真的<strong>超累</strong>！这也是最终促使我购买新房的原因。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftbywzz6waj31kw16o7wh.jpg" alt=""></p>
<blockquote>
<p>我购买楼盘的一房一价表</p>
</blockquote>
<h2 id="新房的坏处"><a href="#新房的坏处" class="headerlink" title="新房的坏处"></a>新房的坏处</h2><p>新房也有坏处，即新房一般是期房，二手房一般三四个月的流程走完后，就可以交房了，而新房一般需要等待两年左右(被捂成准现房的大约1年甚至更短)。</p>
<p>有些新房的学区是暂时没有确定的，存在一定的不确定因素。</p>
<h1 id="新房购买流程"><a href="#新房购买流程" class="headerlink" title="新房购买流程"></a>新房购买流程</h1><p>在上海购买新房一般需要经历<em>认筹、验资、交认筹金、摇号、选房、付首付、办理贷款、网签等后续过程</em>。</p>
<h2 id="认筹与验资"><a href="#认筹与验资" class="headerlink" title="认筹与验资"></a>认筹与验资</h2><p>认筹与验资其实是一个过程，新楼盘拿到zf开盘许可证后，一般有一周左右的时间让客户认筹。认筹是需要验资的，验资一方面是验证购房者有购房资格，另一方面是验证购房者能够拿出足够的首付款和资金来购买此楼盘的房子。</p>
<p>拥有购房资格据我所知一般有两种途径，一种是已经落户了的，这种最好办，带个人户口卡或户籍证明原件及复印件到现场即可;另一种是<strong>已婚</strong>并连续缴纳五年以上的社保的，相比之下第二种更为麻烦，所带的材料大约有结婚证、社保缴纳证明和夫妻双方身份证原件和复印件。(我比较幸运，从复旦毕业后，幸运地落了户。所以走的第一条，<strong>第二条所需材料可能不全</strong>)</p>
<p>检验资产这部分是根据楼盘售价定的，主要是确保你有此楼盘售价最便宜房屋的资金的首付(首套不低于35%/二套不低于70%)。比如我看的楼盘，房屋售价从400-700w，那么就需要有银行开具的200w存款证明(首套)，并且需要冻结认筹金50w。又比如昨天新开的<strong>前滩晶耀</strong>，由于地段好，售价大多在1000w以上，需要验资410w(<em>二套820w</em>)，冻结认筹金<strong>234</strong>万。</p>
<p>由于新房的性价比不同，认筹比差别非常大，有些楼盘认筹比大约是<strong>1000%</strong>，被笑称为彩票盘;有些性价比低的楼盘认筹比仅有<strong>1.5%</strong>。一句话，群众的眼睛是雪亮的，认筹比越高的楼盘通常意味着性价比越高。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftbzm120m4j30m80go76r.jpg" alt=""></p>
<blockquote>
<p>博主所购楼盘认筹现场</p>
</blockquote>
<h2 id="摇号"><a href="#摇号" class="headerlink" title="摇号"></a>摇号</h2><p>摇号是由公证处完成并公布的，有没有猫腻我不知道，但大抵是公平的。虽然有人说，凡是有阳光照到的地方都有阴影。但作为毫无背景的人来说，也只能是听天由命了。我一个好朋友，在杭州3000多人认筹的楼盘里摇号结果为第一名。这件事也从一个侧面说明了，运气还是很重要的。当然我平时<strong>好事做的比较多</strong>，运气也很好，1700认筹里排在了320+，还算是比较靠前的。</p>
<h2 id="选房"><a href="#选房" class="headerlink" title="选房"></a>选房</h2><p>选房之前，是需要好好研究上文提到的一房一价表的，需要将在预算内的房子，综合考虑性价比和想要的程度，列一个从前往后的list。很幸运，我所列的list第一个房间就被我选到啦，12楼的东边套，因此我仅用了<strong>5秒钟</strong>就完成了这一步骤。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ftc00326z4j31400u0q5h.jpg" alt=""></p>
<blockquote>
<p>我们的选房攻略</p>
</blockquote>
<p>上面的步骤还是很重要的，因为不是每个人都可以如我一般幸运。如果号够靠前，很容易在里面纠结很久，看到后面进来的人选了房子，很难不着急。特别是在想要的楼栋号和楼层之间怎么选，1楼、2楼和顶楼、次顶楼怎么选，在你纠结的时候，你发现旁边人把你的候选项选走了，选择空间越来越小。当然，号码比较靠后也不全是坏处，选择空间不大了，倒也不至于那么纠结，因为凡事都有两面性。</p>
<p>多说两句，选房现场和外场不是同一个地方，大约1分钟放10个人进去，这10个人是不分先后选房顺序的，如果1分钟后，你没有选房，又会进来10个人跟你一起选，同样，没有先后顺序。外场跟传销现场差不多，一旦里面有客户选房成功，喇叭里就会喊:”恭喜客户选房成功！” 在外面的人变得更紧张了。真正轮到你之后，会有人带领你<strong>冲</strong>选房内场，并以极快的语速向你喊：“要几号楼几楼，快！快！快！”那语气感觉跟抢劫没啥两样，如果你没有提前做好攻略，很容易进退维谷。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftc09s78qnj31kw0ehtqs.jpg" alt=""></p>
<blockquote>
<p>内场选房现场，几乎全部售出</p>
</blockquote>
<p>选好之后，工作人员会将印有该房间的信息和售价贴到你的选房卡上，这时候就不能反悔了，认筹金就自动变为了<strong>定金</strong>。</p>
<h2 id="付首付等后续环节"><a href="#付首付等后续环节" class="headerlink" title="付首付等后续环节"></a>付首付等后续环节</h2><p>我刚刚进行到这一环节，知道的也比较少。一般选完房之后，开发商会给约一周的时间给你筹款。这里<strong>郑重申明</strong>一下:由于上海房价较高，因此即使是首套，首付款也不可能只有35%,因为通常工薪阶层的人贷不到那65%。当然，如果你收入高或者有自己的产业、公司，提供流水，最低最低也要准备房价的35%。<em>我发现很多人将首付款误解为了房价的35%，其实除了贷款外的所有钱，都是需要你一次性给清的。</em></p>
<p>一句话:</p>
<blockquote>
<p>首付款 = 房价 - 你能贷款到的钱</p>
</blockquote>
<p>贷款的话，就在<strong>售楼现场</strong>咨询各家银行贷款的信息，选一家贷款最多的吧，一般建设银行和中国银行是比较好的。为什么一定要在售楼现场，因为如果不是开发商合作的银行，将会非常麻烦，要走的流程很复杂，所以不推荐。</p>
<p>后续的等走完全部流程，在下一篇博客中写。</p>
<h1 id="一点小建议"><a href="#一点小建议" class="headerlink" title="一点小建议"></a>一点小建议</h1><p>由于我现在已经购入了房子，因此说话难免有失公允，但我仍觉得当下对于上海是一个好的购房时机。原因如下：</p>
<ol>
<li>在上海已经限制一般公司购房的大背景下，博主所购的楼盘依然一日卖光，说明了上海不缺买房的资金，也不缺买房的人，缺的是高性价比的产品，像上海现在这样的低谷期，遇到合适的就上。</li>
<li>zf调控楼市，对购房者有利，从容进场，比恐慌性地进场更能选到自己喜欢的房子。</li>
<li>由于房企资金链压力，房企不得不接受zf的低价入市，精装房子没有降低标准，性价比比后续的要高。</li>
<li><strong>在城市里拥有一本印有自己名字的房产证，其意义是何等重要，无法用文字来表达，不仅是代表了从此之后有了安身立命之处，也是从无产转变到有产的标志，人生地位从此跨出新舞台。</strong>(引自房产孟老师的微博)</li>
</ol>
<p>用梁老师的微博结束正文部分，共勉吧。最后祝大家都能买到自己<strong>称心如意</strong>的房子!</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1ftc0sjm2cjj30u01sz0wb.jpg" alt=""></p>
<blockquote>
<p>梁老师的微博</p>
</blockquote>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>感谢<strong>父母</strong>，他们每天辛勤劳作、省吃俭用为我准备了首付款;</p>
<p>感谢大家庭里的亲人们，在我困难的时候提供了周转资金，让我<strong>倍感温暖</strong>;</p>
<p>感谢之前带我看二手房的中介L总，他跟我年纪相仿，教会了我很多房产的知识。都是在这个大城市奋斗的年轻人，最后没能经他手买到房子，感到有些抱歉;也要感谢龙湖的销售LQQ，这次相处时间并不长，但是给我的建议非常中肯和有用；</p>
<p>last but not least, <strong> My soul-mate xiaoli，Thank you very much indeed! </strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/07/16/buy-house/" data-id="cjl7xi5yj001008tdz71xhed1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随感/">随感</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Match" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/11/Match/" class="article-date">
  <time datetime="2018-07-11T02:30:17.303Z" itemprop="datePublished">2018-07-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/11/Match/">Match for iPhone开发笔记 &lt;一&gt; 开篇杂谈</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="开发Match的初衷"><a href="#开发Match的初衷" class="headerlink" title="开发Match的初衷"></a>开发Match的初衷</h1><p>大约一个月前的某天，一个很久未曾联系的同学突然给我发微信，问我有没有时间帮他做一个iOS App。此人从小学开始就与我是同学，一直是传说中的别人家的孩子，中考、高考都是全市第二名，后进入了南京大学数学系读本科，然后去了复旦读研，跟我又成了校友…</p>
<p>跟他见面后，他给我讲起了故事，在大学，有一棵树，叫高树，很多人挂在了上面多年，甚至无法毕业。因此，他想做一款叫做Match的产品，来帮助高数方面有困难的同学…</p>
<h2 id="Match代表什么"><a href="#Match代表什么" class="headerlink" title="Match代表什么"></a>Match代表什么</h2><p>Match，里面包含了MATH(数学)这个单词，而且有匹配的意思，寓意与答题系统中的求助者寻求匹配的答题者吻合。</p>
<h2 id="我接手Match前"><a href="#我接手Match前" class="headerlink" title="我接手Match前"></a>我接手Match前</h2><p>在找到我之前，他一直看我在朋友圈分享我的技术博客和开发心得，除去编程思想和随感，大多是跟苹果Mac开发和Swift开发相关的，因此他觉得我可以胜任这个工作。回头看，这也可以作为写技术博客的好处之一了吧。</p>
<h2 id="从拒绝到接受"><a href="#从拒绝到接受" class="headerlink" title="从拒绝到接受"></a>从拒绝到接受</h2><p>一开始，我内心是拒绝的，因为坦率的讲，自2015年后，我就再也没进行过iOS的完整应用开发，甚至连网络请求都用不6了，我不得不利用下班和周末时间重拾iOS开发的细节，并在一个极短的时间内完成整个应用的开发工作，并使其尽可能美观，以达到Apple store严格的上架要求。同事，网上充斥着例如：现在重拾iOS跟1948年加入国军没啥区别、iOS开发已经没人要了之类世俗的看法，虽然我并不认同这种看法，但不可否认，<strong>移动开发的红利期过去了。</strong></p>
<p>但他的真诚打动了我，<strong>这真不是一句客套话</strong>，在我了解到他作为一个非科班出身的程序猿，独自完成了Match平台的<strong>前端、后端和Android端</strong>初步开发，还是挺让我感动的，加上我本身喜欢苹果的iDev和swift开发，另外我希望用我的技能，让这个世界变得美好哪怕一点点，因此我当时下我就爽快地答应了他的请求。现在回想起来，还挺佩服我当时的勇气的，因为在做这个iOS APP的过程中，我真的遇到了很多问题，熬了好几夜，终于一一克服。或许，就像电影无问西东电影里的独白说的那样:</p>
<blockquote>
<p>“如果提前了解了你所面对的人生，你是否还有勇气前来？”   ——《无问西东》</p>
</blockquote>
<p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1531287863629&amp;di=b921ee9503b175737d5011be0831eab3&amp;imgtype=0&amp;src=http%3A%2F%2Fpic.spider.com.cn%2Fpic%2Fbookpic%2F201801%2F1516515254495080008.jpg" alt=""></p>
<p>我现在也在反问自己这个问题，如果知道有这么多坑，是不是还会那么爽快的答应下来。</p>
<h1 id="Match-for-iPhone的界面"><a href="#Match-for-iPhone的界面" class="headerlink" title="Match for iPhone的界面"></a>Match for iPhone的界面</h1><p>作为一个完整应用的开发，肯定是无法在一篇博客中写完的，需要<em>一系列</em>文章来将实现的逻辑给<strong>理顺</strong>。本文作为系列文章的开篇之作，暂且不涉及技术细节，而是介绍这款应用的界面和使用，在实现过程中遇到的坑放到后面的博客中写出来与大家分享。</p>
<h2 id="从StoryBoard看整个应用"><a href="#从StoryBoard看整个应用" class="headerlink" title="从StoryBoard看整个应用"></a>从StoryBoard看整个应用</h2><p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1ft5pr6ddzxj31k41hggo8.jpg" alt=""></p>
<blockquote>
<p>Match的StoryBoard原型</p>
</blockquote>
<p>从StoryBoard来看，大约有15个场景，其实由于我的优化，已经将不少可以重复使用的场景进行了合并，达到了复用的目的。</p>
<p>麻雀虽小，五脏俱全，这些场景覆盖了包括登陆页、导航页、问题列表页、问题与回复页、提问题页、写回复页、个人主页、规则说明页、申请提现页和图片预览页等页面，基本上实现了这个平台所需要的所有场景。</p>
<h2 id="真实的界面截图"><a href="#真实的界面截图" class="headerlink" title="真实的界面截图"></a>真实的界面截图</h2><p>真实的界面响应了iOS 11的号召，采用推荐的大标题风格。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1ft5qztdcb1j30v91vodhz.jpg" alt=""></p>
<blockquote>
<p>模仿Apple store的卡片式问题列表页，增加了下拉刷新和上拉加载更多</p>
</blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1ft5rdz2e8fg307s0dwqv6.gif" alt=""></p>
<blockquote>
<p>从Github上“学来”的萌萌哒登录页</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1ft5r0w55sdj30v91voq4t.jpg" alt=""></p>
<blockquote>
<p>模仿知乎的多Section TableView问题与回复页</p>
</blockquote>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1ft5r2bwbxkj30v91vojsl.jpg" alt=""></p>
<blockquote>
<p>坑点巨多的富文本提问和回复页</p>
</blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1ft5r4jilvcj30v91voabt.jpg" alt=""></p>
<blockquote>
<p>设计风格良好的交互框</p>
</blockquote>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1ft5r53oz15j30v91vowgp.jpg" alt=""></p>
<blockquote>
<p>中规中矩的个人主页</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1ft5r5zmt7kj30v91vowgu.jpg" alt=""></p>
<blockquote>
<p>诱人的答题收入页</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1ft5r75c2vsj30v91vodx7.jpg" alt=""></p>
<blockquote>
<p>APP icon 页面，图标由“别人家的孩子”提供</p>
</blockquote>
<p>限于篇幅原因，这里只列出了一小部分应用截图。</p>
<h2 id="系统要求-amp-支持的手机"><a href="#系统要求-amp-支持的手机" class="headerlink" title="系统要求&amp;支持的手机"></a>系统要求&amp;支持的手机</h2><p>系统要求支持iOS 11.0以上，支持的机型包括iPhone 5s、6/7/8 <em>(plus)</em>和 <em>iPhone X</em>。</p>
<p>最后也欢迎大家支持一下Match的<strong>安卓</strong>版，在各大安卓商店有售。</p>
<p>从下一篇开始，我将会把在开发这款应用中遇到的困难和解决方案列出来，作一个总结。</p>
<p>最后学一下电影无问西东，首尾呼应，也当是扪心自问一下：</p>
<blockquote>
<p>“如果提前了解了你所面对的人生，你是否还有勇气前来？”</p>
</blockquote>
<p>电影《无问西东》描述了四段故事，主人公经历着背叛与毁灭，品尝着分别与想念，也都在最后选择了坚持与盛放。其实到现在也不是很理解这部电影的精神和情怀，但我知道我<strong>肯定是没有</strong>。</p>
<p>只能列出张果果最后的独白,分享给大家:</p>
<blockquote>
<p>看到和听到的，经常会令你们沮丧，世俗是这样强大，强大到生不出改变它们的念头来。可是如果有机会提前了解了你们的人生，知道青春也不过只有这些日子，不知你们是否还会在意那些世俗希望你们在意的事情。愿你在被打击时，记起你的珍贵，抵抗恶意；愿你在迷茫时，坚信你的珍贵，爱你所爱，行你所行，听从你心。</p>
</blockquote>
<p><img src="http://t12.baidu.com/it/u=3594607433,4071731292&amp;fm=173&amp;s=B628E1A7579A03D8D1CCEC2F0300A042&amp;w=600&amp;h=375&amp;img.JPEG" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/07/11/Match/" data-id="cjl7xi5xz000m08tdo9uv2lht" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-thunderPassby" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/01/thunderPassby/" class="article-date">
  <time datetime="2018-06-01T11:47:53.000Z" itemprop="datePublished">2018-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/01/thunderPassby/">绕开迅雷的利器:thunderPassby开发笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="thunder-Bypass-for-macOS-开发初衷"><a href="#thunder-Bypass-for-macOS-开发初衷" class="headerlink" title="thunder-Bypass for macOS 开发初衷"></a>thunder-Bypass for macOS 开发初衷</h1><p>前天无意中看到了<a href="http://free.apprcn.com/get-thunder-real-url/" target="_blank" rel="external">Thunder Real Url</a>的限免信息，觉得这款软件有点意思，而且对于我这种<strong>非迅雷vip</strong>来说好像挺有用。不过点进去后发现是windows的客户端，于是我就萌生了做一个<strong><em>功能类似</em></strong>，但<strong><em>体验更好</em></strong>的macOS客户端。</p>
<h1 id="软件开源-下载链接"><a href="#软件开源-下载链接" class="headerlink" title="软件开源/下载链接"></a>软件开源/下载链接</h1><p><a href="https://github.com/zhihaozhang/thunder-Bypass" target="_blank" rel="external">开源地址</a></p>
<p>想下载直接使用的朋友请移步：<br><a href="https://github-production-release-asset-2e65be.s3.amazonaws.com/135258364/f2905dee-65e5-11e8-91ee-5cd6458b500a?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20180602%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20180602T064722Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=21abfd513fa7ec1908a4958e5c0cec59f647cb8061cbbc6d2274782cd0de07e5&amp;X-Amz-SignedHeaders=host&amp;actor_id=4500659&amp;response-content-disposition=attachment%3B%20filename%3DthunderPassby.app.zip&amp;response-content-type=application%2Foctet-stream" target="_blank" rel="external">下载地址</a></p>
<h1 id="软件用途"><a href="#软件用途" class="headerlink" title="软件用途"></a>软件用途</h1><h2 id="icon-gt-软件用途"><a href="#icon-gt-软件用途" class="headerlink" title="icon -&gt; 软件用途"></a>icon -&gt; 软件用途</h2><p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1frtjl9v4kjj308y06mt90.jpg" alt=""></p>
<blockquote>
<p>icon和迅雷icon对比</p>
</blockquote>
<p>icon很有趣，是围绕着迅雷的图标展开的。迅雷的图标是一只鸟，thunder-Bypass旨在<strong>绕开(Bypass)*</strong>迅雷(thunder)<em>，因此，我用迅雷icon那只鸟飞出鸟笼的瞬间作为图标，<em>*寓意着突破迅雷的禁锢</em></em>。</p>
<p>希望icon很好的诠释了软件的用途:</p>
<blockquote>
<p>破解并获得以thunder:// 开头的迅雷下载地址背后的真实下载地址，自动复制到您的剪切板，您可以用非迅雷的第三方下载软件另行下载。 <em>Get the real dwnload url from encrypted thunder url which starts with thunder://</em></p>
</blockquote>
<h2 id="为什么要突破迅雷的限制"><a href="#为什么要突破迅雷的限制" class="headerlink" title="为什么要突破迅雷的限制"></a>为什么要突破迅雷的限制</h2><p>你们也知道，迅雷非vip的下载速度越来越慢了，通过本软件获取真实的磁力链接，然后复制到良心的第三方下载软件，下载速度可以非常快。关于第三方下载软件的推荐，可以参考知乎上的帖子:<a href="https://www.zhihu.com/question/24471469/answer/28122044" target="_blank" rel="external">除了迅雷，还有什么其他下载软件 ？</a></p>
<h2 id="磁力链接是什么"><a href="#磁力链接是什么" class="headerlink" title="磁力链接是什么"></a>磁力链接是什么</h2><p>【1】简单地说，磁力链接是一种特殊链接，但是它与传统基于文件的位置或名称的普通链接不一样，它只是通过不同文件内容的Hash结果生成一个纯文本的“数字指纹”，并用它来识别文件。它类似于生活消费品包装上常见的条码，不同的是这个“数字指纹”可以被任何人从任何文件上生成，这也就注定了“磁力链接”不需要任何“中心机构”的支持（例如：BT Tracker服务器），且识别准确度极高。因此任何人都可以生成一个Magnet链接并确保通过该链接下载的文件准确无误。更简单地说：类似【magnet:?xt=urn:sha1:YNCKHTQCWBTRNJIV4WNAE52SJUQCZO5C】这样以“magnet:?”开头的字符串，就是一条“磁力链接”，其在网页上的图标像一块磁铁，很容易辨别。</p>
<h1 id="软件使用方法"><a href="#软件使用方法" class="headerlink" title="软件使用方法"></a>软件使用方法</h1><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1frvhpcuu58j30qo0ia406.jpg" alt=""></p>
<blockquote>
<p>链接是百度里搜的，貌似有福利哟~</p>
</blockquote>
<p>主界面很清爽，上面的textField是提供给用户输入需要破解的迅雷下载地址的。<strong>注意该url前后不要有空格、回车等特殊字符，否则可能造成无法解码。</strong></p>
<p>点击中间的解锁按钮后，如果解码成功，下面的textField会显示解码后的磁力链接，并<strong>自动</strong>复制到您的剪切板，通知中心会发送通知。</p>
<p>当然，无论解码成功与否，通知中心均会有相应提示。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1frvhqibpksj30is0gijtb.jpg" alt=""></p>
<h1 id="破解机制"><a href="#破解机制" class="headerlink" title="破解机制"></a>破解机制</h1><p>破解机制是在网上找的，<a href="https://www.douban.com/note/624978147/" target="_blank" rel="external">参考2</a>，其实就是去掉thunder://后，用base64解密，解密后的url在前面加了AA，在最后加了ZZ。</p>
<p>核心代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">decryptButtonClicked</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> thunderURL = thunderURLFiled.stringValue</div><div class="line">        <span class="keyword">if</span> thunderURL.hasPrefix(<span class="string">"thunder://"</span>) &#123;</div><div class="line">            <span class="keyword">let</span> encryptedURL = thunderURL.substring(from: thunderURL.index(thunderURL.startIndex,offsetBy :<span class="number">10</span>))</div><div class="line">            </div><div class="line">            </div><div class="line">            <span class="keyword">let</span> decryptedURL0 = <span class="type">Base64FS</span>.decodeString(str: encryptedURL)</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> decryptedURL0.<span class="built_in">count</span> &gt; <span class="number">0</span>&#123;</div><div class="line">                </div><div class="line">                <span class="keyword">let</span> decryptedURL1 = decryptedURL0.substring(from: decryptedURL0.index(decryptedURL0.startIndex,offsetBy :<span class="number">2</span>))</div><div class="line">            </div><div class="line">                <span class="keyword">let</span> decryptedURL2 = decryptedURL1.substring(to: decryptedURL1.index(decryptedURL1.endIndex,offsetBy :-<span class="number">2</span>))</div><div class="line">                </div><div class="line">                decryptedURL.stringValue = decryptedURL2</div><div class="line">                </div><div class="line">                <span class="comment">// copy decrypted URL automaticly for users</span></div><div class="line">                <span class="keyword">let</span> pasteboard = <span class="type">NSPasteboard</span>.general</div><div class="line">                pasteboard.declareTypes([<span class="type">NSPasteboard</span>.<span class="type">PasteboardType</span>.string], owner: <span class="literal">nil</span>)</div><div class="line">                pasteboard.setString(decryptedURL2, forType: <span class="type">NSPasteboard</span>.<span class="type">PasteboardType</span>.string)</div><div class="line">                </div><div class="line">                <span class="keyword">let</span> userNotification = <span class="type">NSUserNotification</span>()</div><div class="line">                userNotification.title = <span class="string">"Message"</span></div><div class="line">                userNotification.subtitle = <span class="string">"恭喜成功破解迅雷下载地址"</span></div><div class="line">                userNotification.informativeText = <span class="string">"提示:地址已帮您复制到剪切板"</span></div><div class="line">                <span class="comment">// 使用NSUserNotificationCenter发送NSUserNotification</span></div><div class="line">                <span class="keyword">let</span> userNotificationCenter = <span class="type">NSUserNotificationCenter</span>.<span class="keyword">default</span></div><div class="line">               </div><div class="line">               </div><div class="line">                userNotificationCenter.delegate = <span class="keyword">self</span></div><div class="line">                </div><div class="line">                userNotificationCenter.scheduleNotification(userNotification)</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">let</span> userNotification = <span class="type">NSUserNotification</span>()</div><div class="line">                userNotification.title = <span class="string">"Message"</span></div><div class="line">                userNotification.subtitle = <span class="string">"解码失败"</span></div><div class="line">                userNotification.informativeText = <span class="string">"请输入正确的迅雷下载地址"</span></div><div class="line">                <span class="comment">// 使用NSUserNotificationCenter发送NSUserNotification</span></div><div class="line">                <span class="keyword">let</span> userNotificationCenter = <span class="type">NSUserNotificationCenter</span>.<span class="keyword">default</span></div><div class="line">                </div><div class="line">                </div><div class="line">                userNotificationCenter.delegate = <span class="keyword">self</span></div><div class="line">                </div><div class="line">                userNotificationCenter.scheduleNotification(userNotification)</div><div class="line">                </div><div class="line">                thunderURLFiled.stringValue = <span class="string">""</span></div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125; <span class="keyword">else</span>&#123;</div><div class="line">            </div><div class="line">            <span class="keyword">let</span> alert = <span class="type">NSAlert</span>()</div><div class="line">            alert.addButton(withTitle: <span class="string">"OK"</span>)</div><div class="line">            </div><div class="line">            alert.messageText = <span class="string">"Alert"</span></div><div class="line">            </div><div class="line">            alert.informativeText = <span class="string">"please input correct thunder download url which hasPrefix thunder://"</span></div><div class="line">            </div><div class="line">            alert.alertStyle = .informational</div><div class="line">        </div><div class="line">            alert.beginSheetModal(<span class="keyword">for</span>: <span class="keyword">self</span>.view.window!, completionHandler: <span class="literal">nil</span>)</div><div class="line">            </div><div class="line">            thunderURLFiled.stringValue = <span class="string">""</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>主要的坑点是有些链接是以thunder://开头的，但是并不能被正确的解码，并引起了程序的崩溃，必须对解码的过程加入错误判断。</p>
<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>开发完成后，有网友留言说网上有很多在线的，这点我确认过了，确实有。如果提早知道有，我想我还是会做它。因为不管这事看起来有多么简单、无意义，你没有探索过，就无法体会到其中探索的乐趣。另外，这件事或许只是对于开发者来说相对简单，普通用户想理解base64就比较困难，更别说实现它了，他们更想要一个GUI的界面，给输入，得到想要的输出，实现的过程他们不想关心。</p>
<p>也有人留言说迅雷加密的方式有很多，这个我试了10多条下载链接，暂时没有发现不符合上面提到的加密方式的，欢迎网友提供反例帮我完善解密机制。</p>
<p>最后用蔡学镛老师的一段话结束本文，大家共勉:</p>
<blockquote>
<p>建立一个自己的项目，很重要。它不属于公司或其他人，是你独自拥有的一种精神寄托。它有一部分研究性质，有一部分实验性质，如果还有应用潜力甚至商业潜力就更好了。这样项目的存在，会让你专注思考和动手，会激发你精益求精的态度。你不会在意别人是否理解你在干什么，因为你的自信爆棚。 ​​​  ——蔡学镛</p>
</blockquote>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>1.<a href="https://www.zhihu.com/question/36151980/answer/66732525" target="_blank" rel="external">知乎：郭无心的回答</a><br>2.<a href="https://www.douban.com/note/624978147/" target="_blank" rel="external">豆瓣</a><br>3.<a href="https://github.com/jdjack/Swift-URL-Safe-Base64" target="_blank" rel="external">Github:Base64FS</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/06/01/thunderPassby/" data-id="cjl7xi5zj002408tdmpx2f91s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/macOS开发/">macOS开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ProtocolOP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/20/ProtocolOP/" class="article-date">
  <time datetime="2018-05-20T09:06:16.024Z" itemprop="datePublished">2018-05-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/20/ProtocolOP/">面向协议编程初探</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="从编程范式讲起"><a href="#从编程范式讲起" class="headerlink" title="从编程范式讲起"></a>从编程范式讲起</h1><p>或许你经常听到诸如面向对象编程、面向过程编程、面向协议编程、函数式编程这些词，心中也不免疑惑，这些词都是些啥？</p>
<h2 id="编程范式-on-wiki"><a href="#编程范式-on-wiki" class="headerlink" title="编程范式 on wiki"></a>编程范式 on wiki</h2><p>相比于本文要介绍的面向协议编程，面向对象编程的名声似乎更响。面向对象由于<em>C++</em>和<em>java</em>的流行，成为近二十年来最为流行的<strong><a href="https://zh.wikipedia.org/wiki/编程范型" target="_blank" rel="external">编程范式</a></strong>。其他编程范式还有比面向对象更早的<strong>面向过程编程</strong>、<strong>指令编程</strong>，以及以<em>Haskell</em>为代表的<em>*函数式</em>编程和苹果提出的<em>面向协议</em>编程。</p>
<p>编程范式是一类典型的<strong>编程风格</strong>，是指从事软件工程的一类典型的风格（可以对照方法学）。编程范型提供了（同时决定了）程序员对程序执行的看法。             ——wiki</p>
<h2 id="我理解的编程范式"><a href="#我理解的编程范式" class="headerlink" title="我理解的编程范式"></a>我理解的编程范式</h2><p>说说我的理解，我认为编程范式<strong>反应了某种编程语言的设计者希望程序员在使用他设计的语言时，用什么样的方式去思考问题。</strong>因此不同的编程范式各有自身的长处，也难免有不足之处，在应对各种问题的时候，某种编程范式可能会更适合一些，选择得当，程序员的工作量会减少很多。</p>
<p>一种语言，可能支持多种编程范式，例如Swift，既支持面向协议编程，又支持面向对象编程、面向协议编程和函数式编程。只是在解决不同任务时，某些范式更合适。</p>
<h3 id="Swift-amp-面向对象编程"><a href="#Swift-amp-面向对象编程" class="headerlink" title="Swift &amp; 面向对象编程"></a>Swift &amp; 面向对象编程</h3><p>举个例子，由于历史原因，在开发Cocoa和cocoa touch程序时，还是广泛使用了UIkit、Foundation框架和控制器视图(ViewController)，他们使用的是OC时代的面向对象编程的方式，从<strong>继承</strong>的角度去考虑问题的。</p>
<p><img src="http://img.my.csdn.net/uploads/201210/18/1350528267_1570.jpg" alt=""></p>
<blockquote>
<p>UIkit框架类组织架构图</p>
</blockquote>
<h3 id="Swift-amp-面向过程编程"><a href="#Swift-amp-面向过程编程" class="headerlink" title="Swift &amp; 面向过程编程"></a>Swift &amp; 面向过程编程</h3><p>在解决<strong>动画</strong>、<strong>渲染</strong>、<strong>数据可视化</strong>等问题时，还是以古老的面向过程式的思维方式进行编程。因为在画图时，先绘制的东西会被后绘制的东西盖住，形成<strong>层(Layer)</strong>的概念。如果不能保证代码是同步一条条执行，那很可能每次渲染出来的图形是不同的。</p>
<h3 id="Swift-amp-函数式编程"><a href="#Swift-amp-函数式编程" class="headerlink" title="Swift &amp; 函数式编程"></a>Swift &amp; 函数式编程</h3><p><a href="https://objccn.io/products/functional-swift/" target="_blank" rel="external">函数式编程</a>本身是一个很大的课题，精髓是避免使用程序状态和可变对象，从而降低程序复杂度。函数式编程强调执行的结果，而非执行的过程。我们先构建一系列简单却具有一定功能的小函数，然后再将这些函数进行组装以实现完整的逻辑和复杂的运算，这是函数式编程的基本思想。</p>
<p>Swift在函数式编程方面表现虽不如Haskell来的纯粹，但是作为一个比Haskell流行的多的语言，和很多已有的函数式编程语言，Swift在语法上更加优雅灵活，语言本身也遵循了函数式的设计模式，是大部分程序员接触函数式编程的第一门语言。以后有机会单独介绍一下函数式编程，有兴趣的读者也可以先看chase Zhang的这篇<a href="https://io-meter.com/2017/05/29/A-Brief-Intro-to-Functional-Programming/" target="_blank" rel="external">blog</a>。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1frhyb0vzaaj30q80er0t2.jpg" alt=""></p>
<h1 id="面向协议编程出现的历史"><a href="#面向协议编程出现的历史" class="headerlink" title="面向协议编程出现的历史"></a>面向协议编程出现的历史</h1><p>回到今天的主角，面向协议编程。面向协议编程是由面向对象编程演变来的，协议在诸如c++和java等面向对象的语言中有一个别名，<strong>接口</strong>。(别骂街、别关网页，好戏在后头)</p>
<h2 id="面向对象编程的好处"><a href="#面向对象编程的好处" class="headerlink" title="面向对象编程的好处"></a>面向对象编程的好处</h2><p>面向对象编程这些年能够风光无限，主要是由于它有的很多优点，例如：</p>
<ol>
<li>数据封装</li>
<li>访问控制</li>
<li>类型抽象为类</li>
<li>继承关系，更符合人类思维</li>
<li>代码以逻辑关系组织到一起，方便阅读</li>
<li>由于继承、多态的特性，自然设计出高内聚、低耦合的系统结构，使得系统更灵活、更容易扩展，而且成本较低</li>
<li>在设计时，可重用现有的，在以前的项目的领域中已被测试过的类使系统满足业务需求并具有较高的质量</li>
</ol>
<p>这么多优点，不可能一下全抛弃，所以也注定了面向协议编程不是一种革命性的编程范式，而是对面向对象编程的改良和演变。</p>
<h2 id="Who-is-Crusty-at-Apple"><a href="#Who-is-Crusty-at-Apple" class="headerlink" title="Who is Crusty at Apple"></a>Who is Crusty at Apple</h2><p>长久以来，大家似乎默认了面向对象编程的好处都是由class带来的，但在苹果公司内部，有个叫Crusty的老兄<strong>think different</strong>了，他认为这一切是抽象类型带来的，而不是class带来的。我们知道，在面向对象编程中，接口和类都是对数据类型的抽取，类只是抽象类型众多实现的手段之一。在很多编程语言中，Struct和枚举同样可以做到对数据类型的抽取。</p>
<blockquote>
<p>It’s Type, not Classes.                           ————Crusty</p>
</blockquote>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1frhz1ha9i8j30jg0d6dg6.jpg" alt=""></p>
<p>Crusty认为，较好的抽象类型应该：</p>
<ol>
<li>更多地支持值类型，同时也支持引用类型</li>
<li>更多地支持静态类型关联（编译期），同时也支持动态派发（runtime）</li>
<li>结构不庞大不复杂</li>
<li>模型可扩展</li>
<li>不给模型强制添加数据</li>
<li>不给模型增加初始化任务的负担</li>
<li>清楚哪些方法该实现哪些方法不需实现</li>
</ol>
<p>经过改良的接口，达到了上面的要求，并改名为协议。至此，苹果决定将面向对象中的继承父类发展为服从协议，面向协议编程出现了。</p>
<h1 id="面向协议编程的好处"><a href="#面向协议编程的好处" class="headerlink" title="面向协议编程的好处"></a>面向协议编程的好处</h1><p>前面提到了，经过Apple改良的接口达到了上节提出的较好抽象类型的目标。Swift的面向协议编程相比于OC的面向对象编程的好处主要体现在两点：1.<strong>动态派发的安全性</strong>、2.<strong>横切关注点</strong>。</p>
<h2 id="动态派发的安全性"><a href="#动态派发的安全性" class="headerlink" title="动态派发的安全性"></a>动态派发的安全性</h2><p>OC有强大的Runtime，在OC中，message与方法是在执行阶段绑定的，而不是编译阶段。简单的说 [a someFunc] 这样一个调用，在编译阶段，编译器并不知道someFunc要执行哪段代码。这个时候[a someFunc]会被转换为 objc_msgSend(a, “someFunc”)，字面的意思也很容易理解，就是给a这个instance，发“someFunc”这个消息，以selector的形式。在运行阶段，执行到上述的objc_msgSend这个函数时。函数内部会到a对应的内存地址，寻找someFunc这个方法的地址，并执行。如果找不到，就会抛一个“unknown selector sent to instance”的异常。（比如.h中声明了方法，但.m中没有实现，就可以重现这个错误）</p>
<p>下面举的例子来自于喵神在MDCC 16上的演讲<a href="https://blog.csdn.net/it_zhaoxiaowei/article/details/53436851" target="_blank" rel="external">《面向协议编程与 Cocoa 的邂逅》</a>中的ppt：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="type">ViewController</span> *v1 = ...</div><div class="line">[v1 myMethod];</div><div class="line"><span class="type">AnotherViewController</span> *v2 = ...</div><div class="line">[v2 myMethod];</div><div class="line"><span class="type">NSObject</span> *v3 = [<span class="type">NSObject</span> new] <span class="comment">// v3      `myMethod`</span></div><div class="line"><span class="type">NSArray</span> *array = @[v1, v2, v3];</div><div class="line"><span class="keyword">for</span> (id obj <span class="keyword">in</span> array) &#123;</div><div class="line">    [obj myMethod];</div><div class="line">&#125;</div><div class="line"><span class="comment">// Runtime error:</span></div><div class="line"><span class="comment">// unrecognized selector sent to instance blabla</span></div></pre></td></tr></table></figure>
<p>上面的代码是可以编译过的，但是在运行时程序会崩溃。有了<strong>协议</strong>(<strong>protocol</strong>),可以申明数组的每个对象都是遵从某个协议的，如果塞进去了不遵从该协议的对象，就会报错，通不过编译。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Greetable</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cat</span>: <span class="title">Greetable</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> name: <span class="type">String</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"meow~ <span class="subst">\(name)</span>"</span>)</div><div class="line">&#125; &#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> array: [<span class="type">Greetable</span>] = [</div><div class="line">        <span class="type">Person</span>(name: <span class="string">"Wei Wang"</span>),</div><div class="line">        <span class="type">Cat</span>(name: <span class="string">"onevcat"</span>)]</div><div class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> array &#123;</div><div class="line">    obj.greet()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Bug</span>: <span class="title">Greetable</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> name: <span class="type">String</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// Compiler Error:</span></div><div class="line"><span class="comment">// 'Bug' does not conform to protocol 'Greetable'</span></div><div class="line"><span class="comment">// protocol requires function 'greet()'</span></div></pre></td></tr></table></figure>
<h2 id="横切关注点-Cross-Cutting-Concerns"><a href="#横切关注点-Cross-Cutting-Concerns" class="headerlink" title="横切关注点(Cross-Cutting Concerns)"></a>横切关注点(Cross-Cutting Concerns)</h2><p>由于大部分面向对象的编程语言都是单继承的，导致了某些功能是不同类之间都需要的，但是由于改类已经继承了其他类，或者无法将不同类之间抽取出更多共性(或者说对于某一个小功能点来这样做代价太大)，成为他们的父类，这样不得不在每个类里面重复一遍代码，使得代码很冗长。这样的小功能就可以称为横切关注点。</p>
<p>还是直接拿喵神的例子，假设我们有一个 ViewController，它继承自UIViewController，我们向其中添加一个 myMethod，如果这时候我们又有一个继承自 UITableViewController 的 AnotherViewController，我们也想向其中添加同样的 myMethod，这时，我们迎来了 OOP 的一大困境，那就是我们很难在不同继承关系的类里共用代码。这里的问题用“行话”来说叫做“横切关注点” (Cross-Cutting Concerns)。我们的关注点 myMethod 位于两条继承链 (UIViewController -&gt; ViewCotroller 和 UIViewController -&gt; UITableViewController -&gt; AnotherViewController) 的横切面上。面向对象是一种不错的抽象方式，但是肯定不是最好的方式。它无法描述两个不同事物具有某个相同特性这一点。在这里，特性的组合要比继承更贴切事物的本质。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1fri12dytq6j30c3079dfs.jpg" alt=""></p>
<p>在swift中很容易抽取出协议，并用<strong>extension</strong>关键字提供协议的默认实现，从而避免的代码的重复。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>1.<a href="https://blog.csdn.net/it_zhaoxiaowei/article/details/53436851" target="_blank" rel="external">《面向协议编程与 Cocoa 的邂逅》</a><br>2.<a href="https://zh.wikipedia.org/wiki/编程范型" target="_blank" rel="external">wiki:编程范式</a><br>3.<a href="https://io-meter.com/2017/05/29/A-Brief-Intro-to-Functional-Programming/" target="_blank" rel="external">A Brief Intro to Functional Programming</a><br>4.<a href="https://www.zhihu.com/question/39844612" target="_blank" rel="external">Objective-C 的消息机制如何理解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/05/20/ProtocolOP/" data-id="cjl7xi5y7000t08tdg7nhvhbe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/">swift</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-swift5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/swift5/" class="article-date">
  <time datetime="2018-05-09T13:08:29.803Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/苹果开发/">苹果开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/swift5/">Swift5新特性</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>话说这两天好像是Google IO召开的日子，借机蹭一波热度，唱个反调，浅析一下Swift5可能会出现的新特性，也算是为下个月即将举办的<strong>WWDC</strong>预热预热吧。</p>
<h1 id="ABI稳定性"><a href="#ABI稳定性" class="headerlink" title="ABI稳定性"></a>ABI稳定性</h1><p>ABI稳定性这个话题是一个历史遗留任务，最初是Swift3的目标，苹果的拖延症一直拖到了Swift5，还不一定可以实现。这也是国内很多公司不敢全面拥抱Swift的<strong>重要原因之一</strong>。</p>
<h2 id="ABI是啥"><a href="#ABI是啥" class="headerlink" title="ABI是啥"></a>ABI是啥</h2><p>ABI是Application Binary Interfaces（应用二进制接口）的缩写，它描述了应用程序和操作系统或其他应用程序的低级接口。</p>
<p>在应用程序运行时，Swift二进制需要和其他库或组件通过ABI进行接触，因此ABI定义了非常底层的细节。比如：如何调用一个函数，数据在内存中是如何存储的、元数据在哪以及如何获取到。</p>
<p>由于现在ABI是不稳定的，因此每一个APP都不得不绑定特定版本的Swift动态库。这样从外面看起来，Swift与App的关联比ios系统要更紧密。</p>
<p>举个例子来说，app1使用的是Swift 4.0，因此它绑定的是包含4.0 ABI的Swift 4.0动态库，而app2使用的是Swift 4.1，它绑定的就是包含4.1 ABI的Swift 4.1动态库。如果ABI变得稳定了，那么ABI就可以抽出来，集成到ios系统中，因为它可以跟Swift的任一版本兼容。</p>
<h2 id="ABI的重要性"><a href="#ABI的重要性" class="headerlink" title="ABI的重要性"></a>ABI的重要性</h2><p>通过上面的描述，应该不难看出ABI的重要性了，总结一下ABI稳定性带来的好处吧：</p>
<ul>
<li>App所占的大小会减小</li>
<li>Swift变化也没现在这么频繁</li>
<li>版本变化时，更少的改动</li>
<li>因为不需要绑定特定版本的swift，开发者可以做出预编译的框架</li>
</ul>
<p>但凡事都有两面性，由于带上了ABI这个脚链，不可避免的也会引入一些缺点：</p>
<ul>
<li>限制了接口的变动</li>
<li>Swift的发展和演化需要考虑的东西也渐渐多了起来</li>
</ul>
<h1 id="Async-Await-模式"><a href="#Async-Await-模式" class="headerlink" title="Async/Await 模式"></a>Async/Await 模式</h1><p>熟悉javascript的朋友应该对这个模式不陌生，在ES7中，也加入了这个模式应对异步编程。这个好用的特性，即将引入Swift5！</p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>之前，例如错误处理、回调之类的异步API用起来挺麻烦的，组合调用时很容易产生出复杂的控制流，用Swift的guard let语法糖在闭包调用中看起来重重嵌套，开发者很难知道当前所处的上下文。</p>
<p>举个例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadWebResource</span><span class="params">(<span class="number">_</span> path: String, completionBlock: <span class="params">(result: Resource)</span></span></span> -&gt; <span class="type">Void</span>) &#123; ... &#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeImage</span><span class="params">(<span class="number">_</span> r1: Resource, <span class="number">_</span> r2: Resource, completionBlock: <span class="params">(result: Image)</span></span></span> -&gt; <span class="type">Void</span>)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">dewarpAndCleanupImage</span><span class="params">(<span class="number">_</span> i : Image, completionBlock: <span class="params">(result: Image)</span></span></span> -&gt; <span class="type">Void</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">processImageData1</span><span class="params">(completionBlock: <span class="params">(result: Image)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</div><div class="line">   loadWebResource(<span class="string">"dataprofile.txt"</span>) &#123; dataResource <span class="keyword">in</span></div><div class="line">      loadWebResource(<span class="string">"imagedata.dat"</span>) &#123; imageResource <span class="keyword">in</span></div><div class="line">         decodeImage(dataResource, imageResource) &#123; imageTmp <span class="keyword">in</span></div><div class="line">            dewarpAndCleanupImage(imageTmp) &#123; imageResult <span class="keyword">in</span></div><div class="line">               completionBlock(imageResult)</div><div class="line">             &#125;</div><div class="line">          &#125;</div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>引入Async/Await模式后，现在的代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadWebResource</span><span class="params">(<span class="number">_</span> path: String)</span></span> async -&gt; <span class="type">Resource</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">decodeImage</span><span class="params">(<span class="number">_</span> r1: Resource, <span class="number">_</span> r2: Resource)</span></span> async -&gt; <span class="type">Image</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">dewarpAndCleanupImage</span><span class="params">(<span class="number">_</span> i : Image)</span></span> async -&gt; <span class="type">Image</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">processImageData1</span><span class="params">()</span></span> async -&gt; <span class="type">Image</span> &#123;</div><div class="line">    <span class="keyword">let</span> dataResource = await loadWebResource(<span class="string">"dataprofile.txt"</span>)</div><div class="line">    <span class="keyword">let</span> imageResource = await loadWebResource(<span class="string">"imagedata.dat"</span>)</div><div class="line">    <span class="keyword">let</span> imageTmp = await decodeImage(dataResource, imageResource)</div><div class="line">    <span class="keyword">let</span> imageResult = await dewarpAndCleanupImage(imageTmp)</div><div class="line">    <span class="keyword">return</span> imageResult</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>此处应有掌声</p>
</blockquote>
<h1 id="Actors"><a href="#Actors" class="headerlink" title="Actors"></a>Actors</h1><ul>
<li>Actors是一个新概念，它表示现实世界中的一些概念，比如“一个文档”、“一台设备”、“一次网络请求”等。</li>
<li>它是调度队列、可运行在该队列上并受该队列保护的数据的组合</li>
<li>可以认为是类似于class和protocol的一种新类型</li>
<li>允许开发者在其中定义内部变量/函数从而管理数据、进行相关操作</li>
<li>不能返回值、抛出异常、没有inout参数</li>
<li>开发者可以与之异步通信，Actor可以保证它所保护的数据只被运行于其上的代码接触到</li>
<li>UIKit和AppKit可以将主线程建模成MainActor</li>
<li>和class、protocol一样，开发者可以用extension关键字扩展MainActor</li>
<li>当引用数变为0时，Actor生命周期完成</li>
</ul>
<p>举个例子，假设正在开发一个tableview的应用，内容是一个string数组(受保护数据)，代码看起来应该是这样:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">actor <span class="type">TableModel</span> &#123;</div><div class="line">    <span class="keyword">let</span> mainActor : <span class="type">TheMainActor</span></div><div class="line">    <span class="keyword">var</span> theList : [<span class="type">String</span>] = [] &#123;</div><div class="line">        <span class="keyword">didSet</span> &#123;</div><div class="line">            mainActor.updateTableView(theList)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(mainActor: <span class="type">TheMainActor</span>) &#123; </div><div class="line">        <span class="keyword">self</span>.mainActor = mainActor </div><div class="line">    &#125;</div><div class="line">    actor <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(entry: String)</span></span> &#123;</div><div class="line">      theList.append(entry)</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h1 id="其他提升"><a href="#其他提升" class="headerlink" title="其他提升"></a>其他提升</h1><ul>
<li>String:对正则表达式<strong>Language级别</strong>的支持、性能提升。</li>
<li>标准库的改进</li>
<li>改进Foundation</li>
<li>增加了新语法</li>
</ul>
<p>让我们一起静待WWDC2018的到来！</p>
<p>参考</p>
<ol>
<li><a href="https://www.developerinsider.in/what-will-be-new-in-swift-5/" target="_blank" rel="external">本文主要翻译自：DeveloperInsider</a>.</li>
<li><a href="https://www.jianshu.com/p/5860f5542f21" target="_blank" rel="external">Swift库二进制接口(ABI)兼容性研究</a></li>
<li><a href="https://imtx.me/archives/2370.html" target="_blank" rel="external">Swift 5 的蓝图：ABI 稳定</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zhihaozhang.github.io/2018/05/09/swift5/" data-id="cjl7xi5zb002008td0d658vqr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/">swift</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/d3/">d3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/visualization/">visualization</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/苹果开发/">苹果开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/购房/">购房</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随感/">随感</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/">Json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVG/">SVG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3/">d3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macOS开发/">macOS开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随感/">随感</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/d3/" style="font-size: 20px;">d3</a> <a href="/tags/iOS开发/" style="font-size: 12px;">iOS开发</a> <a href="/tags/macOS开发/" style="font-size: 18px;">macOS开发</a> <a href="/tags/swift/" style="font-size: 14px;">swift</a> <a href="/tags/随感/" style="font-size: 16px;">随感</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/24/invisibilitycloak/">上架沙盒化应用,重启应用后保持文件持久访问性指南</a>
          </li>
        
          <li>
            <a href="/2018/08/02/Match3/">Match for iPhone开发笔记 &lt;三&gt; 测试与上架篇</a>
          </li>
        
          <li>
            <a href="/2018/07/30/FunctionalPrograming/">浅谈函数式编程 (Introducing Functional Programming)</a>
          </li>
        
          <li>
            <a href="/2018/07/23/Match2/">Match for iPhone开发笔记 &lt;二&gt; 网络请求和数据流篇</a>
          </li>
        
          <li>
            <a href="/2018/07/18/buy-houseII/">魔都买房杂记(下)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Chih-Hao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>